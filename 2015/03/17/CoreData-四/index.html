<html>
<head>
	
	<title>CoreData(四)</title>
	<meta name="keywords" content="My Blog, Spider Bitch!" />

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    
    <!--<link rel="stylesheet" href="/css/main.css">-->
	<link href="/css/main.css?v=2" rel="stylesheet" type="text/css" />
    <!--<link rel="stylesheet" href="/css/style.css">-->
    

    <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Atom feed">

    
	<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2"/>
    

</head>

<body>

<h6 id="coredata-and-swift-by-yongsir"><a href="#CoreData-and-Swift-by-YongSir&#x1F1E8;&#x1F1F3;&#x1F1E8;&#x1F1F3;" class="headerlink" title="CoreData and Swift by YongSir&#x1F1E8;&#x1F1F3;&#x1F1E8;&#x1F1F3;"></a>CoreData and Swift by YongSir&#x1F1E8;&#x1F1F3;&#x1F1E8;&#x1F1F3;</h6><p>&#x5B9E;&#x9645;&#x4F7F;&#x7528;&#x4E2D;&#xFF0C;&#x4F7F;&#x7528;tableView&#x6765;&#x5C55;&#x793A;&#x6570;&#x636E;&#x662F;&#x5982;&#x6B64;&#x7684;&#x666E;&#x904D;&#xFF0C;&#x4EE5;&#x81F3;&#x4E8E;&#x5B98;&#x65B9;&#x9488;&#x5BF9;&#x5217;&#x8868;&#x4E2D;&#x7684;&#x65B9;&#x4FBF;&#x7684;&#x5C55;&#x73B0;&#x505A;&#x4E86;&#x5C01;&#x88C5;&#xFF0C;&#x8FD9;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x8FD9;&#x4E00;&#x7BC7;&#x7684;&#x4E3B;&#x8981;&#x76EE;&#x7684;&#xFF0D;&#xFF0D;NSFetchedResultsController&#x3002;</p>
<p>In fact, they saw so much potential for a close connection between UITableView and Core Data that they penned a class to formalize this bond: NSFetchedResultsController.</p>
<p>As the name suggests, NSFetchedResultsController is a controller, but it is not a view controller. It has no user interface. Its purpose is to make developers&#x2019; lives easier by abstracting away much of the code needed to synchronize a table view with a data source backed by Core Data.</p>
<p>Set up an NSFetchedResultsController correctly, and your table will &#x201C;magically&#x201D; mimic its data source without you have to write more than a few lines of code.</p>
<p><em>&#xFF08;&#x5C31;&#x50CF; NSFetchedResultsController &#x7684;&#x540D;&#x79F0;&#xFF0C;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x63A7;&#x5236;&#x5668;&#x4F46;&#x4E0D;&#x662F;view&#x7684;&#x63A7;&#x5236;&#x5668;&#xFF0C;&#x53EA;&#x662F;&#x4FBF;&#x4E8E;&#x6570;&#x636E;&#x548C;tableView&#x5173;&#x8054;&#x7684;&#x62BD;&#x8C61;&#x7684;&#x5C01;&#x88C5;&#x4EE3;&#x7801;&#xFF0C;&#x8BA9;&#x4F60;&#x77ED;&#x77ED;&#x51E0;&#x884C;&#x4EE3;&#x7801;&#xFF0C;&#x5C31;&#x80FD;&#x201C;&#x9B54;&#x6CD5;&#x822C;&#x7684;&#x201D;&#x8BA9;coreData&#x6570;&#x636E;&#x6E90;&#x5316;&#xFF09;</em></p>
<p>&#x6211;&#x4EEC;&#x501F;&#x7528;&#x4E00;&#x4E2A;WorldCup &#x7684;Demo&#x6765;&#x6F14;&#x7EC3;&#xFF1A;Demo&#x6A21;&#x62DF;&#x7403;&#x961F;&#x7684;&#x79EF;&#x5206;&#xFF0C;tap&#x4E00;&#x6B21;&#x4EE3;&#x8868;&#x52A0;&#x4E00;&#x5206;&#xFF0C;&#x5F97;&#x5206;&#x6700;&#x9AD8;&#x7684;&#x5C31;&#x662F;winner&#x3002;</p>
<hr>
<p>&#x9996;&#x5148;&#x662F;&#xFF0C;&#x521B;&#x5EFA;&#x548C;&#x8BBE;&#x7F6E;NSFetchedResultsController&#xFF0C;&#x4F7F;&#x7528;&#x552F;&#x4E00;&#x7684;&#x4E00;&#x4E2A;&#x521D;&#x59CB;&#x5316;&#x65B9;&#x6CD5;&#xFF1A;</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">// MARK:&#x8BBE;&#x7F6E;fetchedResultsController</span></span><br><span class="line">  <span class="comment">// handles the coordination between Core Data and your table view</span></span><br><span class="line">  <span class="comment">// requires at least one sort descriptor.Note that how would it know the right order for table view</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">setFetchController</span><span class="params">()</span></span> {</span><br><span class="line">     <span class="comment">// 1 &#x521B;&#x5EFA;&#x8BF7;&#x6C42; &#xFF0B; &#x6307;&#x5B9A;&#x6392;&#x5E8F;</span></span><br><span class="line">     <span class="keyword">let</span> fetchRequset = <span class="type">NSFetchRequest</span>(entityName: <span class="string">&quot;Team&quot;</span>)</span><br><span class="line">     <span class="keyword">let</span> sortDescriptor = <span class="type">NSSortDescriptor</span>(key: <span class="string">&quot;teamName&quot;</span>, ascending: <span class="literal">true</span>)</span><br><span class="line">     fetchRequset.sortDescriptors = [sortDescriptor]</span><br><span class="line"></span><br><span class="line">     <span class="comment">// 2 fetch&#x63A7;&#x5236;&#x5668;&#x7684;&#x5B9E;&#x4F8B;&#x8BDD;&#x4ECD;&#x7136;&#x4F9D;&#x8D56;&#x4E8E; NSFetchRequest &#x548C; context&#x4E0A;&#x4E0B;&#x6587;</span></span><br><span class="line">     fetchedResultsController = <span class="type">NSFetchedResultsController</span>(fetchRequest: fetchRequset, managedObjectContext: coreDataStack.context, sectionNameKeyPath: <span class="literal">nil</span>, cacheName: <span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line">     <span class="comment">// 3 &#x63A7;&#x5236;&#x5668;&#x6267;&#x884C;&#x83B7;&#x53D6; &#xFF0D;&#xFF0D;performFetch &amp;&amp; &#x9519;&#x8BEF;&#x5904;&#x7406;</span></span><br><span class="line">     <span class="keyword">do</span> {</span><br><span class="line">          <span class="keyword">try</span> fetchedResultsController.performFetch()</span><br><span class="line">     } <span class="keyword">catch</span> <span class="keyword">let</span> error <span class="keyword">as</span> <span class="type">NSError</span> {</span><br><span class="line">          <span class="built_in">print</span>(<span class="string">&quot;Error:\(error.localizedDescription)&quot;</span>)</span><br><span class="line">     }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x7279;&#x522B;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;FetchedResultsController&#x662F;&#x4F9D;&#x8D56;&#x4E8E;&#x666E;&#x901A;&#x7684;NSFetchRequest&#x7684;&#xFF0C;&#x5E76;&#x4E14;&#x8FD9;&#x4E2A;request&#x81F3;&#x5C11;&#x9700;&#x8981;&#x6307;&#x5B9A;&#x4E00;&#x79CD;sort&#xFF0C;&#x5426;&#x5219;&#x5C31;&#x4F1A;&#x62A5;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos;NSInvalidArgumentException&apos;, reason: &apos;An instance of NSFetchedResultsController requires a fetch request with sort descriptors&apos;</span><br></pre></td></tr></table></figure>
<p>&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;fetchResultsController&#x8FD8;&#x5C06;fetch&#x5230;&#x7684;&#x7ED3;&#x679C;&#x5C01;&#x88C5;&#x5728;&#x4E86;fetchObjects&#x5C5E;&#x6027;&#x548C;objectAtIndexPath&#x4E2D;&#xFF0C;&#x5728;dataSource&#x4E0B;&#x662F;&#xFF1A;<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> fetchedResultsController.sections!.<span class="built_in">count</span></span><br></pre></td></tr></table></figure></p>
<p>&#x7136;&#x540E;&#x83B7;&#x53D6;&#x6A21;&#x578B;&#x6570;&#x636E;&#xFF0C;&#x88C5;&#x586B;&#x5230;cell&#x662F;&#x8FD9;&#x6837;&#x7684;&#xFF1A;<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">configureCell</span><span class="params">(cell: TeamCell, indexPath: NSIndexPath)</span></span> {</span><br><span class="line">     <span class="comment">// &#xFF0D; &#x901A;&#x8FC7;fetchCtoller&#x83B7;&#x53D6;&#x6570;&#x636E;</span></span><br><span class="line">     <span class="keyword">let</span> team = fetchedResultsController.objectAtIndexPath(indexPath) <span class="keyword">as</span>! <span class="type">Team</span></span><br><span class="line">     <span class="comment">// &#xFF0D; cell&#x8BBE;&#x7F6E;</span></span><br><span class="line">     cell.flagImageView.image = <span class="type">UIImage</span>(named: team.imageName)</span><br><span class="line">     cell.teamLabel.text = team.teamName</span><br><span class="line">     cell.scoreLabel.text = <span class="string">&quot;Wins: \(team.wins)&quot;</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x8865;&#x5145;&#x5B8C;&#x6210;&#x201C;tap&#x52A0;1&#x201D;&#x7684;&#x529F;&#x80FD;&#xFF1A;<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MARK: -- tableView delegat --</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">tableView</span><span class="params">(tableView: UITableView,</span><br><span class="line">  didSelectRowAtIndexPath indexPath: NSIndexPath)</span></span> {</span><br><span class="line">   <span class="keyword">let</span> team = fetchedResultsController.objectAtIndexPath(indexPath) <span class="keyword">as</span>! <span class="type">Team</span></span><br><span class="line">   <span class="comment">// tap&#x52A0;1 &#x64CD;&#x4F5C;</span></span><br><span class="line">   <span class="keyword">let</span> wins = team.wins.integerValue</span><br><span class="line">   team.wins = <span class="type">NSNumber</span>(integer: wins + <span class="number">1</span>) <span class="comment">// &#x7C7B;&#x578B;&#x8F6C;&#x6362;</span></span><br><span class="line">   <span class="comment">// &#x4FDD;&#x5B58;</span></span><br><span class="line">   coreDataStack.saveContext()</span><br><span class="line">   <span class="comment">// &#x5237;&#x65B0;UI</span></span><br><span class="line">   tableView.reloadData()</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x81F3;&#x6B64;&#x57FA;&#x672C;&#x7684;&#x529F;&#x80FD;&#x5C31;&#x5B8C;&#x6210;&#x4E86;&#xFF0C;&#x4ECE;&#x6570;&#x636E;&#x5C55;&#x793A;&#x5230;&#x6570;&#x636E;&#x66F4;&#x6539;&#xFF0C;&#x5012;&#x662F;&#x5E76;&#x6CA1;&#x89C1;&#x5F97;&#x6709;&#x4EC0;&#x4E48;magic&#x7684;&#x5730;&#x65B9;&#xFF0C; &#x1F613;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x5C31;&#x662F;&#x653E;&#x5927;&#x62DB;&#x7684;&#x65F6;&#x5019;</p>
<hr>
<ul>
<li><p>&#x5C06;&#x5404;&#x4E2A;&#x961F;&#x4F0D;&#x5C0F;&#x7EC4;&#x5316;</p>
<p>  There are six qualifying zones in the World Cup: Africa, Asia, Oceania, Europe, South America and North/Central America. The Team entity has a string attribute named qualifyingZone that stores this information.</p>
<p>  &#x4EFB;&#x52A1;&#x662F;&#x5C31;&#x5C06;&#x5404;&#x4E2A;&#x56FD;&#x5BB6;&#x653E;&#x5230;&#x5176;&#x5BF9;&#x5E94;&#x7684;&#x9884;&#x9009;&#x8D5B;&#x533A;&#x7684;section&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x901A;&#x5E38;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8FD9;&#x770B;&#x8D77;&#x6765;&#x662F;&#x4E2A;&#x9700;&#x8981;&#x9996;&#x5148;&#x6574;&#x7406;model&#x7136;&#x540E;&#x518D;&#x6539;&#x5199;&#x6570;&#x636E;&#x6E90;&#x65B9;&#x6CD5;&#x7684;&#x7E41;&#x7410;&#x6B65;&#x9AA4;&#xFF0C;&#x4F46;&#x662F;&#x501F;&#x52A9;fetchedResultsController&#x5C31;&#x4F1A;&#x5BB9;&#x6613;&#x5F88;&#x591A;&#xFF0C;&#x4EC5;&#x4EC5;&#x53EA;&#x9700;&#x8981;&#x66F4;&#x6539;2&#x4E2A;&#x5C0F;&#x5730;&#x65B9;&#x5373;&#x53EF;&#xFF1A;</p>
<ol>
<li><p>&#x66F4;&#x6539;fetchResultsController&#x7684;&#x5B9E;&#x4F8B;&#x5316;funcsetFetchController() &#x4E2D;&#xFF1A;</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2 fetch&#x63A7;&#x5236;&#x5668;&#x7684;&#x5B9E;&#x4F8B;&#x8BDD;&#x4ECD;&#x7136;&#x4F9D;&#x8D56;&#x4E8E; NSFetchRequest &#x548C; context&#x4E0A;&#x4E0B;&#x6587;</span></span><br><span class="line"><span class="comment">// &#x66F4;&#x6539;&#x4F7F;&#x7528;keyPath&#x201C;qualifyingZone&#x201D;&#x505A;&#x5B9E;&#x4F8B;&#x5316;</span></span><br><span class="line">fetchedResultsController = <span class="type">NSFetchedResultsController</span>(fetchRequest: fetchRequset, managedObjectContext: coreDataStack.context, sectionNameKeyPath: <span class="string">&quot;qualifyingZone&quot;</span>, cacheName: <span class="literal">nil</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>&#x5B9E;&#x73B0;dataSourece&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x4E3A;section&#x8BBE;&#x7F6E;title&#xFF1A;</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">// &#x8BBE;&#x7F6E;title</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">tableView</span><span class="params">(tableView: UITableView, titleForHeaderInSection section: Int)</span></span> -&gt; <span class="type">String</span>? {</span><br><span class="line">    <span class="keyword">let</span> sectionInfo = fetchedResultsController.sections![section]</span><br><span class="line">    <span class="keyword">return</span> sectionInfo.name</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>&#x8FD0;&#x884C;&#x5F97;&#x5230;&#x6548;&#x679C;&#xFF1A;</p>
<p><img src="/img/CoreData4_001.png" alt=""></p>
<p>&#x89C6;&#x89C9;&#x4E0A;&#x5DEE;&#x4E0D;&#x591A;&#x5B9E;&#x73B0;&#x4E86;&#xFF0C;&#x4F46;&#x662F;&#x7B49;&#x7B49;&#xFF0C;&#x963F;&#x6839;&#x5EF7;&#x4E3A;&#x4EC0;&#x4E48;&#x6210;&#x4E86;&#x975E;&#x6D32;&#x7684;&#x961F;&#x4F0D;&#x4E86;&#xFF0C;&#x6570;&#x636E;&#x9519;&#x4E71;&#x4E86;&#xFF0C;&#x662F;cell&#x91CD;&#x7528;&#x7684;&#x7684;&#x95EE;&#x9898;&#x8FD8;&#x662F;&#x672C;&#x8EAB;&#x6570;&#x636E;&#x7684;&#x95EE;&#x9898;&#xFF1F;<br>&#x8FD9;&#x91CC;&#x5E94;&#x8BE5;&#x6570;&#x636E;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x56E0;&#x4E3A;&#x6392;&#x5E8F;&#x6307;&#x5B9A;&#x7684;&#x4ECD;&#x7136;&#x8FD8;&#x662F;&#x6309;&#x7167;A&#xFF5E;Z&#x7684;&#x987A;&#x5E8F;&#x6392;&#x5217;&#xFF0C;&#x800C;&#x6DFB;&#x52A0;&#x56FD;&#x7C4D;&#x4E4B;&#x540E;&#x6309;&#x56FD;&#x7C4D;group&#x6392;&#x5217;&#x4F1A;&#x4E0E;&#x4E4B;&#x51B2;&#x7A81;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x5C31;&#x5F15;&#x51FA;&#x4E86;&#x5E76;&#x5217;&#x6392;&#x5E8F;&#x4E2D;&#x7684;&#x8457;&#x540D;&#x7684;&#x201C;&#x7591;&#x96BE;&#x6742;&#x75C7;&#x201D;&#xFF0D;&#xFF0D;<strong>&#x6392;&#x5E8F;&#x89C4;&#x5219;&#x51B2;&#x7A81;</strong>&#xFF1A;</p>
<p>  The problem was the sort descriptor. This is another NSFetchedResultsController &#x201C;gotcha&#x201D; to keep in mind. If you want to separate fetched results using a section keyPath,the first sort descriptor&#x2019;s attribute must match the key path&#x2019;s attribute.</p>
<p>  The documentation for NSFetchedResultsController makes this point emphatically, and with good reason! You saw what happened when the sort descriptor doesn&#x2019;t match the key path&#x2014;your data ends up making no sense.</p>
<p>  &#x6240;&#x4EE5;&#x66F4;&#x6539;&#x5982;&#x4E0B;</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &#x66F4;&#x6539;&#x6392;&#x5E8F; - &#x6CE8;&#x610F;&#x6392;&#x5E8F;&#x4E0D;&#x8981;&#x51B2;&#x7A81;&#xFF0C;&#x5426;&#x5219;&#x4F1A;&#x4E71;&#x6389;</span></span><br><span class="line"><span class="keyword">let</span> zoneSort = <span class="type">NSSortDescriptor</span>(key: <span class="string">&quot;qualifyingZone&quot;</span>, ascending: <span class="literal">true</span>)</span><br><span class="line"><span class="keyword">let</span> scoreSort = <span class="type">NSSortDescriptor</span>(key: <span class="string">&quot;wins&quot;</span>, ascending: <span class="literal">true</span>)</span><br><span class="line"><span class="keyword">let</span> nameSort = <span class="type">NSSortDescriptor</span>(key: <span class="string">&quot;teamName&quot;</span>, ascending: <span class="literal">true</span>)</span><br><span class="line">fetchRequset.sortDescriptors = [zoneSort, scoreSort, nameSort]</span><br></pre></td></tr></table></figure>
<p>  &#x8FD9;&#x6837;&#x5BF9;&#x7ED3;&#x6784;&#x5C31;&#x6309;&#x7167;&#xFF0C;&#x5148;<code>&#x5730;&#x57DF;</code>&#xFF0C;&#x518D;<code>&#x79EF;&#x5206;</code>&#xFF0C;&#x6700;&#x540E;<code>&#x961F;&#x540D;</code>&#x7684;&#x6392;&#x5217;&#x987A;&#x5E8F;&#x4E86;<br>  &#x5728;NSFetchedResultsController&#x7684;&#x534F;&#x52A9;&#x4E4B;&#x4E0B;&#xFF0C;&#x6211;&#x4EEC;&#x4E0D;&#x5FC5;&#x904D;&#x5386;&#x6240;&#x6709;&#x961F;&#x4F0D;&#xFF0C;&#x6309;&#x533A;&#x57DF;&#x5206;&#x522B;&#x5BF9;&#x5E94;&#x627E;&#x5230;&#x5404;&#x4E2A;&#x56FD;&#x5BB6;&#x7EC4;&#x6210;&#x5C0F;&#x7EC4;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x5728;&#x5C0F;&#x7EC4;&#x5185;&#x6392;&#x5E8F;&#xFF0C;&#x800C;&#x662F;&#x5F88;&#x7B80;&#x5355;&#x7684;&#x4EE3;&#x7801;&#x5C31;&#x80FD;&#x5B9E;&#x73B0;&#x8FD9;&#x4E9B;&#x529F;&#x80FD;&#xFF0C;too maigical&#xFF01;</p>
</li>
<li><p>cache&#x7684;&#x5F15;&#x5165;<br>  &#x9996;&#x5148;&#x8003;&#x8651;&#x8FD9;&#x6837;&#x4E00;&#x79CD;&#x573A;&#x666F;&#xFF0C;&#x5982;&#x679C;&#x8FD9;&#x91CC;&#x4E0D;&#x662F;32&#x4E2A;&#x56FD;&#x5BB6;&#xFF0C;&#x800C;&#x662F;&#x8BA9;&#x4F60;&#x73A9;&#x6210;&#x6211;&#x671D;13&#x4EBF;&#x4EBA;&#x7684;&#x4EBA;&#x53E3;&#x5206;&#x7C7B;&#xFF0C;&#x6309;&#x7167;&#x4E0D;&#x540C;&#x7684;&#x7701;&#x5E02;&#x5730;&#x533A;&#x5F52;&#x7C7B;&#x7684;&#x8BDD;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x52BF;&#x5FC5;&#x5E26;&#x6765;&#x4E00;&#x4E2A;&#x6027;&#x80FD;&#x548C;&#x5185;&#x5B58;&#x7684;&#x95EE;&#x9898;&#x3002;&#x6211;&#x53EF;&#x4EE5;&#x81EA;&#x4F5C;&#x806A;&#x660E;&#x7684;&#x5F00;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#xFF0C;like this</p>
<p>  &#x201C;I&#x2019;d just throw that on a background thread!&#x201D; might be your first thought. The table view, however, can&#x2019;t populate itself until all sections are available. You might save yourself from blocking the main thread, but you&#x2019;d still be left looking at a spinner.</p>
<p>  There&#x2019;s no denying that this operation is expensive. At a bare minimum, you should only pay the cost once: figure out the section grouping a single time, and reuse your result every time after that.</p>
<p>  &#x9664;&#x4E86;&#x653E;&#x5230;&#x540E;&#x53F0;&#x7EBF;&#x7A0B;&#x4E4B;&#x5916;&#xFF0C;&#x5BF9;&#x4E8E;&#x7C7B;&#x4F3C;&#x8FD9;&#x6837;&#x7684;&#x2019;&#x6602;&#x8D35;&#x2019;&#x64CD;&#x4F5C;&#xFF0C;&#x6700;&#x597D;&#x7684;&#x548C;&#x6700;&#x5FC5;&#x8981;&#x65B9;&#x5F0F;&#x5C31;&#x662F;&#xFF1A;<code>&#x65E2;&#x7136;&#x65E0;&#x6CD5;&#x907F;&#x514D;&#xFF0C;&#x90A3;&#x5C31;&#x5C3D;&#x91CF;&#x53EA;&#x505A;&#x4E00;&#x6B21;&#xFF01;&#x8FD9;&#x5C31;&#x662F;&#x201C;Cache&#x201D;&#x7684;&#x771F;&#x6B63;&#x610F;&#x4E49;</code>&#x3002;&#x597D;&#x5728;&#x82F9;&#x679C;&#x5DF2;&#x7ECF;&#x4E3A;&#x6211;&#x4EEC;&#x8003;&#x8651;&#x5230;&#x4E86;&#xFF0C;&#x5728;fetchedResultsController&#x7684;&#x5B9E;&#x4F8B;&#x8BDD;&#x4E2D;&#xFF0C;&#x90A3;4&#x4E2A;&#x53C2;&#x6570;&#x7684;&#x505A;&#x540E;&#x4E00;&#x4E2A;&#x5C31;&#x662F;cacheName</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &#x518D;&#x6B21;&#x66F4;&#x6539;&#xFF0C;&#x6307;&#x5B9A;cache&#x7684;name</span></span><br><span class="line">fetchedResultsController = <span class="type">NSFetchedResultsController</span>(fetchRequest: fetchRequset, managedObjectContext: coreDataStack.context, sectionNameKeyPath: <span class="string">&quot;qualifyingZone&quot;</span>, cacheName: <span class="string">&quot;worldCup&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>  &#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;cacheName&#x662F;&#x975E;&#x5E38;sensitive&#x7684;&#xFF0C;&#x4ED6;&#x6807;&#x793A;&#x8FD9;&#x6837;&#x4E00;&#x79CD;&#x201C;&#x5355;&#x4F8B;&#x201D;&#x822C;&#x7684;&#x673A;&#x5236;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x5373;&#x8868;&#x793A;&#x9996;&#x6B21;&#x52A0;&#x8F7D;&#xFF0C;&#x5C31;&#x52A0;&#x8F7D;&#xFF0C;&#x5982;&#x679C;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x5373;&#x975E;&#x9996;&#x6B21;&#x52A0;&#x8F7D;&#xFF0C;&#x5C31;&#x4F1A;&#x6839;&#x636E;&#x8FD9;&#x4E2A;&#x6807;&#x8BB0;&#x53D6;cache&#x4E2D;&#x53BB;&#x53D6;&#x7B2C;&#x4E00;&#x6B21;&#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x4FDD;&#x8BC1;&#x53EA;&#x52A0;&#x8F7D;&#x4E00;&#x6B21;&#x3002;&#x6240;&#x4EE5;&#x5C31;&#x53EF;&#x4EE5;&#x7406;&#x89E3;cacheName&#x7684;sensitive&#x4E86;&#xFF0C;&#x5982;&#x679C;&#x53D8;&#x52A8;&#x4E86;&#x4F7F;&#x7528;&#xFF0C;&#x5C31;&#x7528;deleteCacheName&#x6216;&#x8005;&#x91CD;&#x65B0;&#x6307;&#x5B9A;&#x65B0;&#x7684;name&#x6765;&#x53D8;&#x66F4;&#x3002;</p>
</li>
<li><p>&#x76D1;&#x6D4B;&#x53D8;&#x52A8;<br>  &#x622A;&#x6B62;&#x76EE;&#x524D;&#x53EF;&#x89C1;&#xFF0C;&#x4F7F;&#x7528;NSFetchedResultesController&#x81F3;&#x5C11;&#x5E26;&#x6765;&#x4E24;&#x4E2A;&#x597D;&#x5904;&#xFF1A;&#x65B9;&#x4FBF;&#x5904;&#x7406;section&#x548C;&#x505A;cache&#x5904;&#x7406;&#x3002;&#x4E0B;&#x9762;&#x4ECB;&#x7ECD;&#x7B2C;&#x4E09;&#x4E2A;&#x597D;&#x5904;&#xFF0C;&#x4F46;&#x8981;&#x8BF4;&#x660E;&#x7684;&#x662F;&#xFF0C;&#x867D;&#x7136;&#x529F;&#x80FD;&#x5F3A;&#x5927;&#x4F46;&#x4E5F;&#x5F88;&#x5BB9;&#x6613;&#x51FA;&#x9519;&#xFF0C;&#x5C31;&#x662F;&#x9F2C;&#x795E;&#x7684;&#x201C;&#x8D8A;&#x662F;&#x5F3A;&#x5927;&#x7684;&#x672F;&#x5C31;&#x8D8A;&#x6709;&#x4E0D;&#x53EF;&#x514B;&#x670D;&#x7684;&#x7F3A;&#x9677;&#x548C;&#x98CE;&#x9669;&#x201D;&#x3002;</p>
<p>  <img src="/img/CoreData4_002.png" alt=""></p>
<p>  The third and last benefit is somewhat of a double-edged sword: it is powerful but also easy to misuse.</p>
<p>  &#x5148;&#x56DE;&#x5FC6;&#x5728;&#x201C;Tap &#x52A0; 1&#x201D;&#x7684;&#x529F;&#x80FD;&#x662F;&#xFF0C;Tap&#x4E00;&#x4E0B;wins&#xFF0B;1&#xFF0C;&#x7136;&#x540E;tableView.reloadData&#xFF0C;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x7C97;&#x66B4;&#x6709;&#x6548;&#xFF0C;&#x4F46;&#x5982;&#x679C;&#x8003;&#x8651;&#x7684;&#x66F4;&#x591A;&#x6BD4;&#x5982;Demo&#x7684;&#x4E0B;&#x4E00;&#x4E2A;&#x7248;&#x672C;&#xFF0C;&#x5982;&#x679C;&#x5E76;&#x4E0D;&#x662F;&#x901A;&#x8FC7;&#x8FD9;&#x79CD;&#x201C;tap&#xFF0B;1&#x201D;&#x83B7;&#x5F97;&#x79EF;&#x5206;&#xFF0C;&#x800C;&#x662F;&#x4ECE;&#x7F51;&#x7EDC;&#x83B7;&#x53D6;win&#x79EF;&#x5206;&#xFF0C;&#x5C31;&#x5E94;&#x8BE5;&#x8003;&#x8651;&#x4E00;&#x79CD;&#x66F4;&#x52A0;&#x63A5;&#x8FD1;&#x57FA;&#x7840;&#x6570;&#x636E;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x505A;&#x5230;&#x53EA;&#x8981;&#x6570;&#x636E;&#x6709;&#x53D8;&#x5316;&#x5C31;&#x80FD;&#x53CA;&#x65F6;&#x7684;&#x5C55;&#x793A;&#x3002;</p>
<p>  Maybe there&#x2019;s a detail screen for every team where you can change the score. Maybe the app calls an API endpoint and gets new score information from the web service. It would be your job to refresh the table view for every code path that updates the underlying data.</p>
<p>  &#x8FD9;&#x5C31;&#x9700;&#x8981;NSFetchedResultsController&#x7684;&#x4EE3;&#x7406;&#x6765;&#x5E2E;&#x5FD9;&#x4E86;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x76D1;&#x542C;&#x57FA;&#x7840;&#x6570;&#x636E;&#x7684;&#x53D8;&#x5316;&#x8FC7;&#x7A0B;&#xFF0C;&#x8BA9;&#x4F60;&#x8F7B;&#x677E;&#x505A;&#x5230;&#x53EA;&#x8981;&#x57FA;&#x7840;&#x6570;&#x636E;&#x53D8;&#x5316;&#x5C31;&#x81EA;&#x52A8;&#x5237;&#x65B0;&#x5217;&#x8868;&#x663E;&#x793A;&#xFF1A;</p>
<p>  NSFetchedResultsController can listen for changes in its result set and notify its delegate, NSFetchedResultsControllerDelegate. You can use this delegate to refresh the table view as needed any time the underlying data changes.</p>
<blockquote>
<p>Note: A fetched results controller <code>can only monitor changes made via the managed object context specified in its initializer</code>. If you create a separate NSManagedObjectContext somewhere else in your app and start making changes there, your delegate method won&#x2019;t run until those changes have been saved and merged with the fetched results controller&#x2019;s context.</p>
</blockquote>
<p>  &#x64CD;&#x4F5C;&#x4E0A;&#x9700;&#x8981;&#x9075;&#x5B88;&#x534F;&#x8BAE; <code>NSFetchedResultsControllerDelegate</code> &#xFF0C;&#x8BBE;&#x7F6E;&#x4EE3;&#x7406;</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &#x8BBE;&#x7F6E;&#x4EE3;&#x7406;</span></span><br><span class="line">fetchedResultsController.delegate = <span class="keyword">self</span></span><br></pre></td></tr></table></figure>
<p>  &#x5B9E;&#x73B0;&#x65B9;&#x6CD5;&#xFF1A;</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MARK: -- NSFetchedResultsControllerDelegate</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">controllerDidChangeContent</span><span class="params">(controller: NSFetchedResultsController)</span></span> {</span><br><span class="line">  <span class="comment">// &#x518D;&#x6B21;&#x66F4;&#x65B0;UI</span></span><br><span class="line">  tableView.reloadData()</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>  &#x867D;&#x7136;&#x6539;&#x52A8;&#x5E76;&#x4E0D;&#x5927;&#xFF0C;&#x4F46;&#x8FD9;&#x6837;&#x5C31;&#x610F;&#x5473;&#x7740;&#xFF0C;&#x57FA;&#x7840;&#x6570;&#x636E;&#x53EA;&#x8981;&#x6709;&#x4EFB;&#x4F55;&#x6539;&#x52A8;&#xFF0C;&#x4E0D;&#x7BA1;&#x662F;&#x901A;&#x8FC7;tap&#x8FD8;&#x662F;&#x4ECE;&#x7F51;&#x7EDC;&#x83B7;&#x53D6;&#x4ECE;&#x800C;&#x6539;&#x52A8;&#xFF0C;&#x90FD;&#x4F1A;&#x5237;&#x65B0;&#x5217;&#x8868;&#x6570;&#x636E;&#x3002;&#x4F46;&#x4EC5;&#x4EC5;&#x662F;&#x8FD9;&#x6837;&#x8FD8;&#x662F;&#x4E0D;&#x591F;&#xFF0C;&#x867D;&#x7136;&#x6211;&#x5E76;&#x6CA1;&#x80FD;&#x91CD;&#x590D;&#x9519;&#x8BEF;&#xFF0C;&#x5012;&#x662F;&#x8DF3;&#x8DC3;&#x611F;&#x5F88;&#x5F71;&#x54CD;&#x4F53;&#x9A8C;&#xFF1A;</p>
<p>  <img src="/img/CoreData4_003.png" alt=""></p>
<p>  The score labels update as before, but this reveals another problem. If you tap around enough times, you might get into a state where teams within a qualifying zone are not ranked by number of wins. For example, in the previous screenshot, you can see Cameroon below Algeria. However, Cameroon has 16 wins and Algeria 9. Also, when the cells do move around, it&#x2019;s pretty jumpy, almost as if you were completely reloading the table every time something changed. :]</p>
<p>  &#x663E;&#x7136;&#x6211;&#x4EEC;&#x8FD8;&#x9700;&#x8981;&#x8C03;&#x6574;&#xFF0C;&#x4E3A;&#x4E86;&#x4E0D;&#x663E;&#x5F97;&#x90A3;&#x4E48;&#x8DF3;&#x8DC3;&#xFF0C;&#x9700;&#x8981;&#x518D;&#x5230;&#x4EE3;&#x7406;&#x4E2D;&#xFF1A;</p>
<p>  The fetched results controller delegate can tell you if something needs to be moved, inserted or deleted due to a change in the fetched results controller&#x2019;s result set.</p>
<p>  &#x7531;&#x4E8E;&#x6539;&#x52A8;&#x90FD;&#x662F;&#x5728;controller&#x7684;&#x7ED3;&#x679C;&#x96C6;&#x5408;&#x4E2D;&#xFF0C;&#x6240;&#x4EE5;&#x501F;&#x52A9;&#x4EE3;&#x7406;&#x53EF;&#x4EE5;&#x8BA9;&#x4F60;&#x51B3;&#x5B9A;&#x662F;&#x5426;&#x53BB;&#x6DFB;&#x52A0;&#xFF0C;&#x5220;&#x9664;&#x6216;&#x8005;&#x79FB;&#x52A8;&#x3002;&#x6362;&#x8A00;&#x4E4B;&#xFF0C;&#x80FD;&#x591F;&#x8BA9;&#x5F00;&#x53D1;&#x8005;&#x63A7;&#x5236;&#x5230;&#x5E95;&#x8BE5;&#x201C;&#x5982;&#x4F55;&#x663E;&#x793A;&#xFF0C;&#x663E;&#x793A;&#x8C01;&#x201D;&#xFF0C;&#x5728;&#x8FD9;&#x91CC;&#xFF0C;&#x6211;&#x4EEC;&#x8981;&#x6539;&#x52A8;&#x4EE3;&#x7406;&#x65B9;&#x6CD5;&#x4E2D;&#x7684;&#x5B9E;&#x73B0;&#xFF1A;</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// MARK: -- NSFetchedResultsControllerDelegate</span></span><br><span class="line"><span class="comment">// &#x6309;&#x7167;&#x201C;begin updates-make changes-end updates&#x201D;&#x7684;&#x987A;&#x5E8F;&#x53D8;&#x66F4;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">controllerWillChangeContent</span><span class="params">(controller: NSFetchedResultsController)</span></span> {</span><br><span class="line">    <span class="comment">// &#x5F00;&#x59CB;&#x66F4;&#x65B0;</span></span><br><span class="line">    tableView.beginUpdates()</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">controller</span><span class="params">(controller: NSFetchedResultsController, didChangeObject anObject: AnyObject, atIndexPath indexPath: NSIndexPath?, forChangeType type: NSFetchedResultsChangeType, newIndexPath: NSIndexPath?)</span></span> {</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;move \(indexPath!) -&gt; \(newIndexPath!)&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span><br><span class="line">    &#x6839;&#x636E;&#x6570;&#x636E;&#x7684;&#x4E0D;&#x540C;type&#xFF0C;&#x8FDB;&#x884C;&#x533A;&#x5206;&#x64CD;&#x4F5C;</span><br><span class="line">       - Insert</span><br><span class="line">       - Delete</span><br><span class="line">       - Update</span><br><span class="line">       - Move</span><br><span class="line">    */</span></span><br><span class="line">    <span class="keyword">switch</span> type {</span><br><span class="line">      <span class="keyword">case</span> <span class="type">NSFetchedResultsChangeType</span>.<span class="type">Insert</span>:</span><br><span class="line">        tableView.insertRowsAtIndexPaths([newIndexPath!], withRowAnimation: <span class="type">UITableViewRowAnimation</span>.<span class="type">Automatic</span>)</span><br><span class="line">      <span class="keyword">case</span> <span class="type">NSFetchedResultsChangeType</span>.<span class="type">Delete</span>:</span><br><span class="line">        tableView.deleteRowsAtIndexPaths([indexPath!], withRowAnimation: <span class="type">UITableViewRowAnimation</span>.<span class="type">Automatic</span>)</span><br><span class="line">      <span class="keyword">case</span> <span class="type">NSFetchedResultsChangeType</span>.<span class="type">Update</span>:</span><br><span class="line">        tableView.cellForRowAtIndexPath(indexPath!) <span class="keyword">as</span>! <span class="type">TeamCell</span></span><br><span class="line">      <span class="keyword">case</span> <span class="type">NSFetchedResultsChangeType</span>.<span class="type">Move</span>:</span><br><span class="line">        tableView.deleteRowsAtIndexPaths([indexPath!], withRowAnimation: <span class="type">UITableViewRowAnimation</span>.<span class="type">Automatic</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//            tableView.insertRowsAtIndexPaths([indexPath!],  withRowAnimation: UITableViewRowAnimation.Automatic)</span></span><br><span class="line"></span><br><span class="line">       tableView.insertRowsAtIndexPaths([newIndexPath!], withRowAnimation: <span class="type">UITableViewRowAnimation</span>.<span class="type">Automatic</span>)</span><br><span class="line">      <span class="keyword">default</span> :</span><br><span class="line">       <span class="keyword">break</span></span><br><span class="line">     }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">controllerDidChangeContent</span><span class="params">(controller: NSFetchedResultsController)</span></span> {</span><br><span class="line">     <span class="comment">// &#x7ED3;&#x675F;&#x66F4;&#x65B0;</span></span><br><span class="line">     tableView.endUpdates()</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x200B;</p>
<p><strong>Note that the order and nature of the methods ties in very neatly to the &#x201C;begin updates-make changes-end updates&#x201D; pattern used to update table views. This is not a coincidence!</strong> &#x8FD9;&#x662F;&#x6309;&#x7167;&#x5B98;&#x65B9;&#x6587;&#x6863;&#x6307;&#x5BFC;&#x7684;&#x6309;&#x7167;&#x201C;&#x5F00;&#x59CB;&#xFF0D;&#x66F4;&#x65B0;&#xFF0D;&#x7ED3;&#x675F;&#x201D;&#x7684;&#x987A;&#x5E8F;&#x3002;<em>&#x6CE8;&#x610F;insert&#x65F6;&#x7531;&#x4E8E;&#x4E0D;&#x5B58;&#x5728;&#x6307;&#x5B9A;index&#x6240;&#x4EE5;&#x8981;newIndexPath&#x7684;</em>    </p>
<p><code>controllerWillChangeContent</code> -&gt;  <code>didChangeObject, atIndexPath, forChangeType type</code> -&gt;  <code>controllerDidChangeContent</code>     </p>
<p>This delegate method is similar to didChangeObject&#x2026; but notifies you of changes to sections rather than to individual objects.&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x4EE3;&#x7406;&#x65B9;&#x6CD5;&#x3002;&#x7C7B;&#x4F3C;&#x4E8E;didChangeObject&#x65B9;&#x6CD5;&#xFF0C;&#x53EA;&#x662F;&#x5173;&#x6CE8;&#x7684;&#x662F;section&#x7684;&#x6539;&#x53D8;&#xFF0C;&#x6BD4;&#x5982;&#x73B0;&#x5728;&#x6709;&#x4E00;&#x53EA;&#x5168;&#x65B0;&#x7684;&#x961F;&#x4F0D;&#x5728;&#x4E00;&#x4E2A;&#x5168;&#x65B0;&#x7684;&#x5206;&#x7EC4;&#xFF08;&#x6216;&#x8BB8;&#x662F;&#x706B;&#x661F;&#x961F;&#x1F61B;&#xFF09;&#x4E4B;&#x4E0B;&#xFF0C;&#x8FD9;&#x4E2A;&#x4EE3;&#x7406;&#x5C31;&#x6709;&#x7528;&#x4E86;     </p>
<p>   &#x5982;&#x679C;&#x6CE8;&#x610F;&#x7EC6;&#x8282;&#x7684;&#x8BDD;&#xFF0C;&#x5728;Demo&#x4E2D;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x9ED8;&#x8BA4;&#x4E0D;&#x542F;&#x7528;&#x7684;addItem&#xFF0C;&#x663E;&#x7136;&#x8FD9;&#x662F;&#x4E3A;&#x6211;&#x5927;&#x56FD;&#x8DB3;&#x51C6;&#x5907;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x8981;&#x662F;&#x7B49;&#x56FD;&#x8DB3;&#x5802;&#x5802;&#x6B63;&#x6B63;&#x7684;&#x8E22;&#x8FDB;&#x4E16;&#x754C;&#x676F;&#xFF0C;&#x5C31;&#x60F3;&#x6B96;&#x6C11;&#x706B;&#x661F;&#x4E00;&#x6837;&#x73B0;&#x5B9E;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x50B2;&#x5A07;&#x7684;&#x8BBE;&#x7F6E;&#x4E86;&#x4E00;&#x4E2A;&#x540E;&#x95E8;&#xFF0C;&#x7528;&#x6765;&#x5C06;&#x6211;&#x5927;&#x56FD;&#x8DB3;&#x4FDD;&#x9001;&#x5230;&#x4E16;&#x754C;&#x676F;&#xFF0C;&#x4F7F;&#x7528;&#x6447;&#x4E00;&#x6447;&#x5373;&#x53EF;&#x6FC0;&#x6D3B;        </p>
<p>&#x200B;</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MARK: &#x9707;&#x52A8;&#x6FC0;&#x6D3B;&#x6DFB;&#x52A0;&#x6309;&#x94AE; &#xFF0D;&gt; &#x4E2D;&#x56FD;&#x961F;&#x51B2;&#x51FB;&#x4E16;&#x754C;&#x676F;&#x4E13;&#x7528;</span></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">motionEnded</span><span class="params">(motion: UIEventSubtype, withEvent event: UIEvent?)</span></span> {</span><br><span class="line">    <span class="keyword">if</span> motion == <span class="type">UIEventSubtype</span>.<span class="type">MotionShake</span> {</span><br><span class="line">    	addButton.enabled = <span class="literal">true</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>  &#x7136;&#x540E;&#x6DFB;&#x52A0;&#x65B9;&#x6CD5;&#xFF1A;</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@available</span>(iOS <span class="number">8.0</span>, *)</span><br><span class="line"><span class="comment">// &#x56FD;&#x8DB3;&#x8D70;&#x540E;&#x95E8;&#x4E13;&#x7528;&#x65B9;&#x6CD5;</span></span><br><span class="line"><span class="meta">@IBAction</span> <span class="function"><span class="keyword">func</span> <span class="title">addTeam</span><span class="params">(sender: AnyObject)</span></span> {</span><br><span class="line">    <span class="keyword">let</span> alert = <span class="type">UIAlertController</span>(title: <span class="string">&quot;&#x5929;&#x671D;&#x7279;&#x8272;&quot;</span>, message: <span class="string">&quot;&#x76EE;&#x524D;&#x770B;&#x6765;&#x4E2D;&#x56FD;&#x8DB3;&#x7403;&#x8FDB;&#x4E16;&#x754C;&#x676F;&#x53EA;&#x80FD;&#x7528;&#x8FD9;&#x79CD;&#x624B;&#x6BB5;&#x4E86;&quot;</span>, preferredStyle: <span class="type">UIAlertControllerStyle</span>.<span class="type">Alert</span>)</span><br><span class="line"></span><br><span class="line">    alert.addTextFieldWithConfigurationHandler { (textField) -&gt; <span class="type">Void</span> <span class="keyword">in</span></span><br><span class="line">        textField.placeholder = <span class="string">&quot;Team name&quot;</span></span><br><span class="line">    }</span><br><span class="line">    alert.addTextFieldWithConfigurationHandler { (textField) -&gt; <span class="type">Void</span> <span class="keyword">in</span></span><br><span class="line">        textField.placeholder = <span class="string">&quot;Qualifying Zone&quot;</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    alert.addAction(<span class="type">UIAlertAction</span>(title: <span class="string">&quot;Save&quot;</span>, style: <span class="type">UIAlertActionStyle</span>.<span class="type">Default</span>, handler: { (action) -&gt; <span class="type">Void</span> <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;&#xFF0D;&#xFF0D;&#x5F00;&#x59CB;&#x4FDD;&#x9001;&#x56FD;&#x8DB3;&#xFF0D;&#xFF0D;&quot;</span>)</span><br><span class="line">        <span class="comment">// 1</span></span><br><span class="line">        <span class="keyword">let</span> nameTextFeild = alert.textFields![<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">let</span> zoneTextFeild = alert.textFields![<span class="number">1</span>]</span><br><span class="line">        <span class="comment">// 2 &#x65B0;&#x63D2;&#x5165;&#x4E00;&#x4E2A;&#x5B9E;&#x4F53;&#xFF0D;&#xFF0D;&#x5F53;&#x7136;&#x5C31;&#x662F;&#x4E07;&#x5E74;&#x8FDB;&#x4E0D;&#x4E86;&#x7684;&#x56FD;&#x8DB3;&#x4E86;</span></span><br><span class="line">        <span class="keyword">let</span> team = <span class="type">NSEntityDescription</span>.insertNewObjectForEntityForName(<span class="string">&quot;Team&quot;</span>, inManagedObjectContext: <span class="keyword">self</span>.coreDataStack.context) <span class="keyword">as</span>! <span class="type">Team</span></span><br><span class="line">        team.teamName = nameTextFeild.text!</span><br><span class="line">        team.qualifyingZone = zoneTextFeild.text!</span><br><span class="line">        team.imageName = <span class="string">&quot;wenderland-flag&quot;</span></span><br><span class="line">        <span class="comment">// 3</span></span><br><span class="line">        <span class="keyword">self</span>.coreDataStack.saveContext()</span><br><span class="line">    }))</span><br><span class="line"></span><br><span class="line">    alert.addAction(<span class="type">UIAlertAction</span>(title: <span class="string">&quot;cancel&quot;</span>, style: <span class="type">UIAlertActionStyle</span>.<span class="type">Cancel</span>, handler: { (action) -&gt; <span class="type">Void</span> <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;&#x88AB;cancel&#xFF0C;&#x679C;&#x7136;&#x4E0A;&#x5E1D;&#x90FD;&#x8981;&#x653E;&#x5F03;&#x56FD;&#x8DB3;&#x4E86;&#x1F640;&quot;</span>)</span><br><span class="line">    }))</span><br><span class="line"></span><br><span class="line">    presentViewController(alert, animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>  &#x4EE3;&#x7801;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#x4E0D;&#x5728;&#x8D58;&#x8FF0;&#xFF0C;&#x603B;&#x4E4B;&#x4E3A;&#x56FD;&#x8DB3;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x793E;&#x4F1A;&#x4E3B;&#x4E49;&#x4F18;&#x8D8A;&#x6027;&#x7684;&#x540E;&#x95E8;&#xFF0C;&#x5E76;&#x5355;&#x72EC;&#x5F00;&#x4E00;&#x4E2A;&#x533A;&#x5C31;&#x80FD;&#x4FDD;&#x8BC1;&#x664B;&#x7EA7;&#x4E86;<br>  <img src="/img/CoreData4_004.png" alt=""></p>
<p>  &#x611F;&#x8C22;&#x5F3A;&#x5927;&#x7684;&#x4EE3;&#x7406;&#xFF0C;&#x8BA9;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x505A;&#x5230;&#x53EA;&#x8981;&#x539F;&#x59CB;&#x6570;&#x636E;&#x66F4;&#x6539;&#xFF0C;&#x5C31;&#x81EA;&#x52A8;&#x89E6;&#x53D1;&#x5237;&#x65B0;&#x6570;&#x636E;&#xFF0C;&#x800C;&#x4E0D;&#x7BA1;&#x539F;&#x59CB;&#x6570;&#x636E;&#x662F;&#x600E;&#x6837;&#x53D8;&#x5316;&#x7684;</p>
<p>  &#x2026;&#x56FD;&#x8DB3;&#x2026;&#x1F64F;</p>
</li>
</ul>


<!--<a href="http://13hoop.github.io/2015/03/17/CoreData-四/#disqus_thread" class="article-comment-link">Comments</a>-->
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = '13hoopgithub'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

<div style="display:none">
<script src="http://s4.cnzz.com/stat.php?id=undefined&web_id=undefined" language="JavaScript"></script>script>
</div>







</body>
</html>