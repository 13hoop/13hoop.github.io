<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>CoreData(一) - 初试，人生若只如初见 | YongSir | 专业程序员伪装者</title>

  
  <meta name="author" content="13hoop">
  

  
  <meta name="description" content="CoreData and Swift by YongSir&amp;#x1F1E8;&amp;#x1F1F3;&amp;#x1F1E8;&amp;#x1F1F3;&amp;#x8FD9;&amp;#x662F;&amp;#x8FD9;&amp;#x672C;&amp;#x4E66;Core Data by Tutorials&amp;#x7684;&amp;#x8BFB;&amp;#x4E66">
  

  
  
  <meta name="keywords" content="">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="CoreData(一) - 初试，人生若只如初见"/>

  <meta property="og:site_name" content="YongSir"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="YongSir" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">YongSir</a>
    </h1>
    <p class="site-description">专业程序员伪装者</p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">主页</a></li>
      
        <li><a href="/archives">归档</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>CoreData(一) - 初试，人生若只如初见</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/03/12/CoreData-一/" rel="bookmark">
        <time class="entry-date published" datetime="2015-03-12T09:28:07.000Z">
          2015-03-12
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h6 id="coredata-and-swift-by-yongsir"><a href="#CoreData-and-Swift-by-YongSir&#x1F1E8;&#x1F1F3;&#x1F1E8;&#x1F1F3;" class="headerlink" title="CoreData and Swift by YongSir&#x1F1E8;&#x1F1F3;&#x1F1E8;&#x1F1F3;"></a>CoreData and Swift by YongSir&#x1F1E8;&#x1F1F3;&#x1F1E8;&#x1F1F3;</h6><p>&#x8FD9;&#x662F;&#x8FD9;&#x672C;&#x4E66;Core Data by Tutorials&#x7684;&#x8BFB;&#x4E66;&#x7B14;&#x8BB0;&#xFF0C;&#x5927;&#x5927;&#x7684;&#x5C01;&#x9762;<br><img src="/img/CoreData1_001_Top.png" alt="&#x5927;&#x5927;&#x7684;&#x5C01;&#x9762;"></p>
<h2 id="section-one"><a href="#section-one" class="headerlink" title="section one"></a>section one</h2><p>First,why we need coreData&#xFF1F;It matters data persistence.</p>
<p>&#x662F;&#x554A;&#xFF0C;&#x5E02;&#x573A;&#x4E0A;&#x6709;<code>SQL</code>&#x548C;<code>Realm</code>&#x8FD9;&#x4E9B;&#x7B80;&#x5355;&#x6613;&#x7528;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x8C01;&#x8FD8;&#x9700;&#x8981;<code>coreData</code><br>&#x4F46;&#x662F;<code>coreData</code>&#x6BD4;&#x4F60;&#x60F3;&#x8C61;&#x7684;&#x5F3A;&#x5927;&#x5F97;&#x591A;&#xFF0C;&#x6700;&#x5927;&#x7684;&#x4F18;&#x52BF;&#x5728;&#x4E8E;&#x662F;&#x82F9;&#x679C;&#x7684;&#x4EB2;&#x513F;&#x5B50;&#xFF0C;&#x5168;&#x5E73;&#x53F0;&#x901A;&#x7528;&#xFF1B;&#x800C;&#x90A3;&#x4E9B;&#x52A8;&#x5219;&#x7528;&#x5176;&#x6548;&#x7387;&#x548C;&#x64CD;&#x4F5C;&#x7684;&#xFF0C;&#x6211;&#x5C31;&#x8865;&#x5145;&#x4E00;&#x6BB5;<code>Marcus Zarra</code>&#x5927;&#x795E;&#x7684;&#x56DE;&#x7B54;&#xFF1A;</p>
<blockquote>
<p>First, my opinion on third-party code is well known: all code sucks. I think Realm is trying to solve a problem that is the incorrect problem to solve. They&#x2019;re trying to be faster than Core Data, whereas Core Data is trying to be fast enough, but maintainable. In my playing and working with Realm, I find that the amount of code you write is about equal. &#x2026; As a project leader or a developer, I want maintainability and consistency. My big concern with third-party frameworks is that they go away. It happens over and over again. We don&#x2019;t know how long Realm&#x2019;s going to be here. I don&#x2019;t understand their business model. Core Data for me is good enough; it&#x2019;s mature, it&#x2019;s been around long enough, and it&#x2019;s fast enough. If it&#x2019;s not fast enough, I&#x2019;m probably doing something wrong because I&#x2019;m in object space anyway. There&#x2019;s a lot of unknowns about Realm.</p>
</blockquote>
<p>CoreData&#x7684;&#x610F;&#x4E49;&#x5728;&#x4E8E;&#x6570;&#x636E;&#x7684;&#x66F4;&#x7075;&#x6D3B;&#x66F4;&#x9AD8;&#x6548;&#x7684;&#x5B58;&#x50A8;&#x548C;&#x5904;&#x7406;&#xFF0C;&#x80FD;&#x591F;&#x5C06;&#x6570;&#x636E;&#x56FA;&#x5316;&#x65F6;&#x6700;&#x8D77;&#x7801;&#x7684;&#x9700;&#x6C42;&#x3002;&#x5E72;&#x5DF4;&#x5DF4;&#x7684;&#x5B66;&#x4E60;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x610F;&#x601D;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x4ECE;&#x8FD9;&#x4E2A;&#x57FA;&#x672C;&#x7684;&#x9700;&#x6C42;&#x5165;&#x624B;&#xFF0C;&#x4E00;&#x4E2A;&#x8054;&#x7CFB;&#x4EBA;&#x7684;Demo&#xFF0C;&#x5229;&#x7528;coreData&#x5B9E;&#x73B0;&#x4FE1;&#x606F;&#x4ECE;&#x5185;&#x5B58;&#x5230;&#x672C;&#x5730;&#x7684;&#x56FA;&#x5316;&#xFF0C;&#x5E76;&#x4ECE;&#x672C;&#x5730;&#x8BFB;&#x53D6;&#x3002;&#x5F15;&#x8FF0;&#x4E66;&#x4E2D;&#x7684;&#x8981;&#x6C42;&#xFF1A;</p>
<p>When you tap the Home button, the app that&#x2019;s currently in the foreground goes to the background. When this happens, the operating system flash-freezes everything currently in memory, including the strings in the names array. Similarly, when it&#x2019;s time to wake up and return to the foreground, the operating system restores what used to be in memory as if you&#x2019;d never left.</p>
<p>what we really want?<br>     to persist the names you enter so they&#x2019;re available for viewing after a fresh app launch.</p>
<h4 id="-the-first-step-is-to-create-a-managed-object-model"><a href="#&#xFF0D;-The-first-step-is-to-create-a-managed-object-model" class="headerlink" title="&#xFF0D; The first step is to create a managed object model"></a>&#xFF0D; The first step is to create a managed object model</h4><p>Since you elected to use Core Data when you created the HitList project, Xcode automatically created a data model file for you and named it HitList.xcdatamodeld.</p>
<ul>
<li><p>An entity is a class definition in Core Data. The classic example is an Employee or a Company. In a relational database, an entity corresponds to a table.</p>
</li>
<li><p>An attribute is a piece of information attached to a particular entity. For example, an Employee entity could have attributes for the employee&#x2019;s name, position and salary. In a database, an attribute corresponds to a particular field in a table.</p>
</li>
<li><p>A relationship is a link between multiple entities. In Core Data, relationships between two entities are called to-one relationships, while those between one and many entities are called to-many relationships. For example, a Manager can have a to-many relationship with a set of employees, whereas an individual Employee will have a to-one relationship with his manager.</p>
</li>
</ul>
<p>As you&#x2019;ve probably noticed, entities sound a lot like a classes. Likewise, attributes/relationships sound a lot like properties. What&#x2019;s the difference? You can think of a Core Data entity as a class &#x201C;definition&#x201D; and the managed object as an instance of that class.</p>
<p>&#x9996;&#x5148;&#xFF0C;&#x9700;&#x8981;&#x521B;&#x5EFA;&#x6258;&#x7BA1;&#x5BF9;&#x8C61;&#x6A21;&#x578B;NSManagedObjectModel&#xFF0C;&#x5C31;&#x662F;&#x6307;&#x5B9A;&#x4E49;&#x5728;.mom&#x4E2D;&#x7684;&#x6240;&#x6709;&#x5B9E;&#x4F53;&#xFF0C;&#x64CD;&#x4F5C;&#x4E2D;&#x5C06;&#x6211;&#x4EEC;&#x7684;&#x6570;&#x636E;&#x6A21;&#x578B;&#x6DFB;&#x52A0;&#x5230;&#x5B83;&#x4E4B;&#x4E2D;</p>
<p>&#x57FA;&#x672C;&#x7684;&#x6982;&#x5FF5;&#xFF1A;<br><em>entity&#x5B9E;&#x4F53;</em>     &#xFF1A; &#x7406;&#x89E3;&#x4E3A;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x7684;&#x8868;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x4E00;&#x79CD;&#x7C7B;&#xFF0C;&#x5982;&#x4E00;&#x4E2A;Class Employee&#x6216;&#x8005;Class Company<br><em>attribute&#x5C5E;&#x6027;</em> &#xFF1A; &#x7406;&#x89E3;&#x4E3A;&#x6570;&#x636E;&#x5E93;&#x8868;&#x4E2D;&#x7684;&#x5B57;&#x6BB5;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x7279;&#x5B9A;&#x5B9E;&#x4F53;&#x7684;&#x5177;&#x4F53;&#x4FE1;&#x606F;&#xFF0C;&#x5982;&#x4E00;&#x4E2A;Employee&#x5B9E;&#x4F53;&#x5305;&#x542B;name&#xFF0C;position&#xFF0C;salary&#x7B49;&#x5C5E;&#x6027;<br><em>relationship&#x5173;&#x7CFB;</em>&#xFF1A; &#x5C31;&#x662F;&#x4E0D;&#x540C;&#x5B9E;&#x4F53;&#x7684;&#x5173;&#x7CFB;&#xFF0C;&#x5728;coreData&#x4E2D;&#xFF0C;&#x4E24;&#x4E2A;&#x5B9E;&#x4F53;&#x95F4;&#x53EB;&#x6709;&#x4E00;&#x5BF9;&#x4E00;&#x5173;&#x7CFB;&#xFF0C;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x5B9E;&#x4F53;&#x548C;&#x591A;&#x4E2A;&#x5B9E;&#x4F53;&#x4E4B;&#x95F4;&#xFF0C;&#x5C31;&#x79F0;&#x4E4B;&#x4E3A;&#x591A;&#x5BF9;&#x4E00;&#x5173;&#x7CFB;&#x3002;&#x6BD4;&#x5982;&#x4E00;&#x4E2A;manager&#x548C;employee&#x4E4B;&#x95F4;&#x5C31;&#x662F;&#x5BF9;&#x591A;&#x5173;&#x7CFB;&#xFF0C;&#x800C;&#x4E00;&#x4E2A;employee &#x548C;manager&#x5C31;&#x662F;&#x5BF9;&#x4E00;&#x7684;&#x5173;&#x7CFB;&#x3002;</p>
<h4 id="-next-replace-the-table-views-model"><a href="#&#xFF0D;-Next-replace-the-table-view&#x2019;s-model" class="headerlink" title="&#xFF0D; Next, replace the table view&#x2019;s model"></a>&#xFF0D; Next, replace the table view&#x2019;s model</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// var names = [String]()</span></span><br><span class="line"><span class="comment">// Change &#x201C;names&#x201D; to &#x201C;people&#x201D; and [String] to [NSManagedObject]</span></span><br><span class="line"><span class="comment">// &#x4F7F;&#x7528;&#x5F3A;&#x5927;&#x7684;NSManagedObject&#x5B9E;&#x4F8B;&#xFF0C;&#x6765;&#x66FF;&#x4EE3;&#x7B80;&#x5355;&#x7684;string</span></span><br><span class="line"><span class="keyword">var</span> people = [<span class="type">NSManagedObject</span>]()</span><br></pre></td></tr></table></figure>
<p><strong>NSManagedObject</strong> represents a single object stored in Core Data&#x2014;you must use it to create, edit, save and delete from your Core Data persistent store. As you&#x2019;ll see shortly, NSManagedObject is a shape-shifter. It can take the form of any entity in your data model, appropriating whatever attributes and relationships you defined.</p>
<ol>
<li>Before you can save or retrieve anything from your Core Data store, you first need to get your hands on an NSManagedObjectContext. You can think of a managed object context as an in-memory &#x201C;scratchpad&#x201D; for working with managed objects.</li>
<li>You create a new managed object and insert it into the managed object context. You can do this in one step with NSManagedObject&#x2019;s designated initializer: init(entity:insertIntoManagedObjectContext:).</li>
<li>With an NSManagedObject in hand, you set the name attribute using key-value coding. You have to spell the KVC key (&#x201C;name&#x201D; in this case) exactly as it appears on your data model, otherwise your app will crash at runtime.</li>
<li>You commit your changes to person and save to disk by calling save on the managed object context. Note that save takes one parameter, which is a pointer to an NSError; if there is ever an error with the save operation, you can inspect the error and alert the user if necessary.</li>
<li>Congratulations! Your new managed object is now safely ensconced in your Core Data persistent store. Insert the new managed object into the people array so that it shows up in the table view when it reloads.</li>
</ol>
<p>&#x5176;&#x6B21;&#xFF0C;&#x4F7F;&#x7528;&#x6258;&#x7BA1;&#x5BF9;&#x8C61; <em>&#xFF3B;NSManagedObject&#xFF3D;</em> &#x96C6;&#x5408;&#x6765;&#x66FF;&#x6362;tableView&#x6570;&#x636E;&#x6A21;&#x578B;&#xFF08;&#x8FD9;&#x91CC;&#x7684;names&#xFF09;<br>&#x6258;&#x7BA1;&#x5BF9;&#x8C61;NSManagedObject&#xFF0C;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x62FF;&#x6765;&#x64CD;&#x4F5C;&#x6570;&#x636E;&#x7684;&#x57FA;&#x672C;&#x5355;&#x4F4D;&#x3002;&#x5BF9;&#x5E94;&#x4E0B;&#x6765;&#xFF1A;</p>
<ul>
<li>&#x589E;&#x52A0;&#x4E00;&#x6761;&#x6570;&#x636E;&#x662F;&#x5728;NSManagedObjectContext&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;NSManagedObject&#x3002;</li>
<li>&#x67E5;&#x627E;&#x6570;&#x636E;&#x662F;&#x67E5;&#x627E;NSManagedObject&#x3002;</li>
<li>&#x4FEE;&#x6539;&#x662F;&#x4FEE;&#x6539;NSManagedObject&#x7C7B;&#x7684;&#x5C5E;&#x6027;&#x3002;</li>
<li>&#x5220;&#x9664;&#x662F;&#x4ECE;NSManagedObjectContext&#x91CC;&#x9762;&#x5220;&#x9664;NSManagedObject&#x7C7B;&#x3002;</li>
</ul>
<p>&#x6700;&#x540E;&#x6211;&#x4EEC;&#x4FDD;&#x5B58;NSManagedObjectContext&#xFF0C;&#x7136;&#x540E;&#x4E00;&#x76F4;&#x5411;&#x4E0A;&#x4F20;&#x9012;&#x5230;&#x78C1;&#x76D8;&#x4E0A;&#x9762;&#x53BB;&#xFF0C;&#x624D;&#x662F;&#x6301;&#x4E45;&#x5316;&#x7684;&#x4FEE;&#x6539;&#x3002;&#x603B;&#x4E4B;&#xFF0C;&#x6A21;&#x578B;&#x5BF9;&#x8C61;&#x7684;&#x6570;&#x636E;&#x88AB;&#x6301;&#x6709;&#x5728;NSManagedObject&#x5BF9;&#x8C61;&#x4E2D;&#x3002;&#x6BCF;&#x4E00;&#x4E2A;NSManagedObject&#x5BF9;&#x8C61;&#x90FD;&#x5BF9;&#x5E94;&#x4E00;&#x4E2A;&#x5B9E;&#x4F53;&#xFF08;&#x5C31;&#x50CF;&#x6BCF;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x90FD;&#x6709;&#x4E00;&#x4E2A;&#x7C7B;&#xFF09;&#x3002;</p>
<p>&#x800C;&#x5BF9;&#x4E8E;NSManagedObject&#x7684;&#x64CD;&#x4F5C;&#x53C8;&#x5F15;&#x51FA;&#x4E00;&#x4E2A;&#x53EB;NSManagedObjectContext&#x7684;&#x4E1C;&#x4E1C;&#xFF0C;&#x8FD9;&#x662F;&#x662F;&#x6211;&#x4EEC;&#x7ECF;&#x5E38;&#x4F7F;&#x7528;&#x5230;&#x7684;&#x4E00;&#x4E2A;&#x7C7B;&#x3002;&#x5BF9;&#x4E8E;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x6709;&#x8FD9;&#x4E2A;&#x7C7B;&#xFF0C;&#x56E0;&#x4E3A;&#x6570;&#x636E;&#x5E93;&#x7684;IO&#x64CD;&#x4F5C;&#x662F;&#x5F88;&#x8D39;&#x65F6;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x628A;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x64CD;&#x4F5C;&#x7F13;&#x5B58;&#x5230;&#x4E86;&#x4E00;&#x4E2A;&#x5185;&#x5B58;&#x533A;&#x57DF;&#xFF0C;&#x7B49;&#x5F85;&#x5408;&#x9002;&#x7684;&#x5B9E;&#x9645;&#x5728;&#x53BB;&#x5199;&#x5165;&#x771F;&#x5B9E;&#x7684;&#x78C1;&#x76D8;&#x4E2D;&#x3002;&#x8FD9;&#x6837;&#x5927;&#x5927;&#x7684;&#x63D0;&#x9AD8;&#x6548;&#x7387;&#x3002;&#x6BD4;&#x5982;&#x63D2;&#x5165;&#x4E00;&#x6761;&#x6570;&#x636E;&#xFF0C;&#x7136;&#x540E;&#x4FEE;&#x6539;&#x6570;&#x636E;&#xFF0C;&#x6700;&#x540E;&#x5220;&#x9664;&#x6389;&#x8FD9;&#x6761;&#x6570;&#x636E;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x6BCF;&#x6B21;&#x90FD;&#x6267;&#x884C;commit&#x7684;&#x8BDD;&#x662F;&#x64CD;&#x4F5C;&#x4E09;&#x6B21;IO&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x628A;&#x8FD9;&#x4E09;&#x6761;&#x5408;&#x5E76;&#x5728;&#x4E00;&#x8D77;commit&#x7684;&#x8BDD;&#x5C31;&#x53EA;&#x6709;&#x4E00;&#x6B21;commit&#x3002;&#x8FD9;&#x6837;&#x80FD;&#x6709;&#x6548;&#x7684;&#x63D0;&#x9AD8;&#x6574;&#x4E2A;&#x7CFB;&#x7EDF;&#x7684;&#x6548;&#x7387;&#x3002;NSManagedObjectContext&#x5C31;&#x662F;&#x4E3A;&#x63D0;&#x4F9B;IO&#x6548;&#x7387;&#x800C;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x201C;&#x6682;&#x5B58;&#x201D;&#x3002;&#x540C;&#x65F6;&#x63D0;&#x524D;&#x6307;&#x51FA;&#x4F7F;&#x7528;Core Data&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF1A;NSManagedObjectContext&#x5E76;&#x4E0D;&#x662F;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x7684;&#xFF0C;&#x66F4;&#x591A;&#x76F8;&#x5173;&#x8BA8;&#x8BBA;&#x5148;&#x5F80;&#x540E;&#x653E;&#x3002;</p>
<h4 id="-fetching-from-coredata"><a href="#&#xFF0D;-Fetching-from-CoreData" class="headerlink" title="&#xFF0D; Fetching from CoreData"></a>&#xFF0D; Fetching from CoreData</h4><p>LoadData from coreData</p>
<ol>
<li>before you can do anything with Core Data, you need a managed object context. Fetching is no different!</li>
<li>Setting a fetch request&#x2019;s entity property, or alternatively initializing it with init(entityName:), fetches all objects of a particular entity. This is what you do here to fetch all Person entities.<br>NSFetchRequest is the class responsible for fetching from Core Data.<br>Fetch requests have several qualifiers that refine the set of results they return.</li>
<li>You hand the fetch request over to the managed object context to do the heavy lifting. executeFetchRequest(_:error:) returns an optional array of managed objects that meets the criteria specified by the fetch request.</li>
</ol>
<p>&#x83B7;&#x53D6;&#x5DF2;&#x4FDD;&#x5B58;&#x7684;&#x6570;&#x636E;&#xFF1A;</p>
<ul>
<li>&#x5148;&#x8981;&#x5F97;&#x5230;&#x4E0A;&#x4E0B;&#x6587;</li>
<li>&#x8BBE;&#x7F6E;fetchRequest</li>
<li>&#x6839;&#x636E;&#x8BF7;&#x6C42;&#x4ECE;&#x4E0A;&#x4E0B;&#x6587;&#x83B7;&#x53D6;&#x6570;&#x636E;&#x5E76;&#x505A;&#x6570;&#x636E;&#x5904;&#x7406;<br><img src="/img/CoreData1_002.png" alt=""></li>
</ul>
<h2 id="section-two"><a href="#section-two" class="headerlink" title="section two"></a>section two</h2><p>&#x5C31;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5C0F;&#x5C0F;&#x7684;BowTie&#x7BA1;&#x7406;&#x7684;demo&#xFF0C;&#x5C31;&#x662F;&#x7BA1;&#x7406;&#x4F60;&#x7684;&#x4E0D;&#x540C;&#x989C;&#x8272;&#x7684;&#x9886;&#x7ED3;&#xFF0C;UI&#x548C;&#x529F;&#x80FD;&#x5982;&#x4E0B;&#xFF1A;<br>     segumentController &#xFF0D; &#x53EF;&#x9009;&#x989C;&#x8272;<br>     name  &#xFF0D; &#x540D;&#x79F0;<br>     rante &#xFF0D; &#x8BC4;&#x5206;&#xFF0C;&#x4ECE;0-5<br>     times &#xFF0D; &#x4F69;&#x6234;&#x6B21;&#x6570;<br>     lastWorn &#xFF0D; &#x4E0A;&#x6B21;&#x4F69;&#x6234;&#x7684;&#x65E5;&#x671F;<br>     Favorite &#xFF0D; &#x662F;&#x5426;&#x6700;&#x7231;<br>     wear &#xFF0D; &#x589E;&#x52A0;&#x4F69;&#x6234;&#x6B21;&#x6570;&#x548C;&#x66F4;&#x65B0;&#x4F69;&#x6234;&#x65E5;&#x671F;<br>     rate &#xFF0D; &#x8BC4;&#x5206;&#x5141;&#x8BB8;&#x4F60;&#x91CD;&#x65B0;&#x8BC4;&#x5206;</p>
<p>OK&#xFF0C;What you have to do now is take this sample data, store it in Core Data and use it to implement the bow tie management functionality.</p>
<h4 id="firstly-create-your-data-model"><a href="#Firstly-create-your-data-model" class="headerlink" title="Firstly ,create your data model"></a>Firstly ,create your data model</h4><p>&#x5728;Bow<em>Ties.xcdatamodeld&#x4E2D;&#x64CD;&#x4F5C;&#xFF0C;&#x6DFB;&#x52A0;Bowtie&#x5B9E;&#x4F53;&#xFF0C;&#x540C;&#x65F6;&#x914D;&#x7F6E;&#x5C5E;&#x6027;&#xFF0C;&#x4E3A;&#x5C5E;&#x6027;&#x9009;&#x53D6;&#x5BF9;&#x5E94;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#xFF0C;&#x4FBF;&#x5229;&#x7684;&#x53EF;&#x89C6;&#x5316;&#x64CD;&#x4F5C;&#x95EE;&#x4EC0;&#x4E48;&#x4E0D;&#x5462;&#x2026;&#x2026;^</em>^</p>
<p><img src="/img/CoreData1_003.png" alt=""><br>Core Data also provides the option of storing arbitrary blobs of binary data directly in your data model. These could be anything from images to PDF files, or anything else that can be serialized into zeroes and ones.</p>
<p>&#x5982;&#x679C;&#x6CE8;&#x610F;&#x5230;&#x6BCF;&#x4E2A;&#x9886;&#x7ED3;&#x90FD;&#x662F;&#x6709;&#x5BF9;&#x5E94;image &#x7684;&#xFF0C;&#x4E8B;&#x5B9E;&#x4E0A;coreData&#x4E5F;&#x652F;&#x6301;&#x5B9A;&#x4E49;&#x4E8C;&#x8FDB;&#x5236;&#x6570;&#x636E;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;photoData&#x5C5E;&#x6027;&#xFF0C;&#x7C7B;&#x578B;&#x9009;&#x4E3A;BinaryData&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x6837;&#x4FBF;&#x5229;&#x7684;&#x7ED3;&#x679C;&#x5C31;&#x662F;&#x4F1A;&#x5E26;&#x6765;&#x6025;&#x5267;&#x7684;&#x6D88;&#x8017;&#xFF0C;&#x6839;&#x636E;SQLite&#x4E2D;&#x7684;&#x4F7F;&#x7528;&#xFF0C;&#x5373;&#x4FBF;&#x53EA;&#x60F3;&#x8981;&#x4E00;&#x4E2A;name&#xFF0C;&#x5185;&#x5B58;&#x4E2D;&#x4E5F;&#x4F1A;&#x5168;&#x90E8;&#x52A0;&#x8F7D;database&#x4E2D;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x6D88;&#x8017;&#x662F;&#x4E0D;&#x53EF;&#x63A5;&#x53D7;&#x7684;&#x3002;</p>
<p>Luckily, Core Data anticipates this problem.&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x5BF9;photoData&#x5C5E;&#x6027;&#x8FDB;&#x884C;&#x914D;&#x7F6E;Allows External Storage&#xFF0C;&#x5982;&#x56FE;&#xFF1A;<br><img src="/img/CoreData1_004.png" alt=""></p>
<blockquote>
<p>The Allows External Storage option is only available for the binary data attribute type.</p>
</blockquote>
<p>When you enable Allows External Storage, Core Data heuristically decides on a per-value basis if it should save the data directly in the database or store a URI that points to a separate file.&#x5F53;&#x9009;&#x53D6;&#x5141;&#x8BB8;&#x5916;&#x90E8;&#x5B58;&#x50A8;&#x65F6;&#xFF0C;CoreData&#x76F4;&#x63A5;&#x9884;&#x5224;&#x662F;&#x5426;&#x5E94;&#x8BE5;&#x4FDD;&#x5B58;&#x6570;&#x636E;&#x5230;database&#x4EA6;&#x6216;&#x662F;&#x8F6C;&#x800C;&#x50A8;&#x5B58;&#x4E00;&#x4E2A;&#x6307;&#x5411;&#x7279;&#x5B9A;&#x6587;&#x4EF6;&#x7684;URL&#x3002;</p>
<p>&#x6240;&#x4EE5;&#xFF0C;&#x76EE;&#x524D;&#x8BF4;&#x6765; coreData &#x652F;&#x6301;&#x5E38;&#x89C1;&#x7684;&#x6240;&#x6709;&#x57FA;&#x672C;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#xFF1A;In sum, besides strings, integers, doubles, Booleans and dates, Core Data can also save binary data, and it can do so efficiently and intelligently.</p>
<p>&#x4F46;&#x4EC5;&#x4EC5;&#x662F;&#x8FD9;&#x6837;&#x8FD8;&#x4E0D;&#x591F;&#xFF0C;&#x56E0;&#x4E3A;&#x66F4;&#x591A;&#x65F6;&#x5019;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x80FD;&#x591F;&#x5B58;&#x50A8;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x7C7B;&#x578B;&#xFF0C;&#x4E00;&#x822C;&#x5C31;&#x662F;&#x81EA;&#x5B9A;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x6BD4;&#x5982;Demo&#x4E2D;&#x6BCF;&#x4E2A;&#x9886;&#x7ED3;&#x90FD;&#x6709;&#x989C;&#x8272;&#xFF0C;&#x800C;&#x57FA;&#x672C;&#x7C7B;&#x578B;&#x4E2D;&#x662F;&#x6CA1;&#x6709;UIColor&#x7684;&#xFF0C;Once again, Core Data has your back&#xFF0C;&#x5728;Attributes&#x7684;Type&#x4E2D;&#x6709;&#x4E2A;Transformable&#x7C7B;&#x578B;&#xFF0C;CoreData&#x5141;&#x8BB8;&#x6240;&#x6709;&#x9075;&#x5FAA;NSCoding&#x534F;&#x8BAE;&#x7684;&#x5BF9;&#x8C61;&#x90FD;&#x53EF;&#x4EE5;&#x5B58;&#x50A8;&#x3002;&#x6B63;&#x5982;UIColor (UIColor conforms to NSSecureCoding, which inherits from NSCoding, so it can use the transformable type out of the box)&#xFF0C;&#x6DFB;&#x52A0;tintColor&#xFF1A;<br><img src="/img/CoreData1_005.png" alt=""></p>
<p>New, data model is now complete. The Bowtie entity has the eight attributes it needs to store all the information in SampleData.plist.</p>
<h4 id="secondly-managed-object-subclasses"><a href="#secondly-managed-object-subclasses" class="headerlink" title="secondly, managed object subclasses"></a>secondly, managed object subclasses</h4><p>&#x5728;section1&#x4E2D;&#x7684;demo&#x4E2D;&#xFF0C;&#x6258;&#x7BA1;&#x5BF9;&#x8C61;&#x4F7F;&#x7528;&#x7684;&#x662F;KVC&#x7ED9;Person&#x5B9E;&#x4F53;&#x7684;name&#x5C5E;&#x6027;&#x8D4B;&#x503C;&#xFF0C;like this&#xFF1A;</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &#x4F7F;&#x7528;KVC&#x5411;&#x5C5E;&#x6027;&#xFF08;attribute&#xFF09;&#x8D4B;&#x503C;</span></span><br><span class="line">person.setValue(name, forKey: <span class="string">&quot;name&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>&#x4F60;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;KVC&#x4F46;&#x5E76;&#x4E0D;&#x610F;&#x5473;&#x7740;&#x5E94;&#x8BE5;&#x7528;&#x5B83;&#xFF0C;&#x56E0;&#x4E3A;KVC&#x7684;&#x7F3A;&#x70B9;&#x4E5F;&#x5F88;&#x660E;&#x663E;&#xFF0C;&#x5C31;&#x662F;&#x5B83;&#x7684;&#x4E00;&#x5207;&#x90FD;&#x4F9D;&#x8D56;&#x4E8E;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;The biggest problem with key-value coding is the fact that you&#x2019;re accessing of data using strings instead of strongly-typed classes. This is often jokingly referred to as writing stringly typed code.</p>
<p>As you probably know from experience, &#x201C;stringly typed&#x201D; code is vulnerable to silly human errors such as mistyping and misspelling. Key-value coding also doesn&#x2019;t take full advantage of Swift&#x2019;s type-checking and Xcode&#x2019;s auto-completion. :]</p>
<p>&#x6700;&#x597D;&#x7684;&#x66FF;&#x4EE3;&#x65B9;&#x5F0F;&#x5C31;&#x662F;&#x5728;&#x6570;&#x636E;&#x6A21;&#x578B;&#x4E2D;&#x4E3A;&#x6BCF;&#x4E2A;&#x5B9E;&#x4F53;&#x521B;&#x5EFA;NSManagedObject&#x5B50;&#x7C7B;&#xFF0C;&#x8FD9;&#x5C31;&#x610F;&#x5473;&#x4F1A;&#x5B58;&#x5728;&#x4E00;&#x4E2A;&#x7740;&#x5305;&#x542B;&#x6240;&#x6709;&#x5BF9;&#x5E94;&#x5C5E;&#x6027;&#x7684;Bowtie&#x7C7B;&#xFF0C;&#x4F7F;&#x7528;Xcode&#x6765;&#x751F;&#x6210;&#x5427;</p>
<p>Make sure you still have Bow_Ties.xcdatamodeld open, and go to Editor\Create NSManagedObject Subclass&#x2026;. Select the data model and then the Bowtie entity in the next two dialog boxes, then select Swift as the language option in the final box. If you&#x2019;re asked, say No to creating an Objective-C bridging header. Click Create to save the file.</p>
<p>Bowtie&#x770B;&#x8D77;&#x6765;&#x5C31;&#x662F;&#x8FD9;&#x6837;&#xFF1A;<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> CoreData</span><br><span class="line"><span class="comment">/*</span><br><span class="line">Similar to @dynamic in Objective-C, the @NSManaged attribute informs</span><br><span class="line">the Swift compiler that the backing store and implementation of a property</span><br><span class="line">will be provided at runtime instead of at compile time.</span><br><span class="line"></span><br><span class="line">The normal pattern is for a property to be backed by an instance variable</span><br><span class="line">in memory. A property on a managed object is different: It&#x2019;s backed by the</span><br><span class="line">managed object context, so the source of the data is not known at compile time.</span><br><span class="line">*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bowtie</span>: <span class="title">NSManagedObject</span> </span>{</span><br><span class="line">    <span class="comment">// bool,double,int -&gt; NSNumber</span></span><br><span class="line">    <span class="meta">@NSManaged</span> <span class="keyword">var</span> isFavorite: <span class="type">NSNumber</span></span><br><span class="line">    <span class="meta">@NSManaged</span> <span class="keyword">var</span> lastWorn: <span class="type">NSDate</span></span><br><span class="line">    <span class="meta">@NSManaged</span> <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="meta">@NSManaged</span> <span class="keyword">var</span> rating: <span class="type">NSNumber</span></span><br><span class="line">    <span class="meta">@NSManaged</span> <span class="keyword">var</span> searchKey: <span class="type">String</span></span><br><span class="line">    <span class="meta">@NSManaged</span> <span class="keyword">var</span> timesWorn: <span class="type">NSNumber</span></span><br><span class="line">    <span class="meta">@NSManaged</span> <span class="keyword">var</span> photoData: <span class="type">NSData</span> <span class="comment">// &#x4E8C;&#x8FDB;&#x5236;&#xFF0D;&gt; NSData</span></span><br><span class="line">    <span class="meta">@NSManaged</span> <span class="keyword">var</span> tintColor: <span class="type">AnyObject</span> <span class="comment">// &#x53EF;&#x53D8;&#x7C7B;&#x578B;&#xFF0D;&gt; AnyObject</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x5982;&#x679C;&#x4E0D;&#x60F3;&#x4F7F;&#x7528;NSNumber&#xFF0C;&#x66F4;&#x52A0;&#x7D27;&#x51C6;&#x7684;&#x7C7B;&#x578B;&#x6620;&#x5C04;&#x9700;&#x8981;&#x5728;&#x521B;&#x5EFA;&#x7C7B;&#x65F6;&#x52FE;&#x9009;Use scalar properties for primitive data types in the last dialog&#xFF0C;&#x867D;&#x7136;&#x8FD9;&#x91CC;&#x6682;&#x65F6;&#x4E0D;&#x52FE;&#x9009;<br><img src="/img/CoreData1_006.png" alt=""></p>
<p>&#x8FD8;&#x6709;&#x5F88;&#x91CD;&#x8981;&#x7684;&#x4E00;&#x70B9;&#xFF0C;&#x4F60;&#x9700;&#x8981;&#x94FE;&#x63A5;Bowtie&#x5230;&#x6570;&#x636E;&#x6A21;&#x578B;&#x7F16;&#x8F91;&#x5668;&#x7684;Bowtie&#x5B9E;&#x4F53;&#x3002;&#xFF08;&#x8111;&#x8865;StoryBoard &#x4E0E; view&#x7684;&#x94FE;&#x63A5;&#xFF09;<br><img src="/img/CoreData1_007.png" alt=""></p>
<p>Next to Class, replace Bowtie with Bow_Ties.Bowtie. This is the fully specified class name for Bowtie.swift. This last step links the runtime Bowtie class to the Bowtie entity in the data model editor.</p>
<p>Congratulations, you&#x2019;ve just made your first managed object subclass in Swift! Compared with key-value coding, this is a much better way of working with Core Data entities. There are two main benefits:</p>
<ol>
<li><p>Managed object subclasses unleash the syntactic power of Swift properties. By accessing attributes using properties instead of key-value coding, you again befriend Xcode and the compiler.</p>
</li>
<li><p>You gain the ability to override existing methods or to add your own convenience methods. Note that there are some NSManagedObject methods you must never override. Check Apple&#x2019;s documentation of NSManagedObject for a complete list.</p>
</li>
</ol>
<h4 id="third-propagating-a-managed-context"><a href="#Third-propagating-a-managed-context" class="headerlink" title="Third ,propagating a managed context"></a>Third ,propagating a managed context</h4><p>&#x4F20;&#x9012;&#x4E0A;&#x4E0B;&#x6587;&#x5230;&#x63A7;&#x5236;&#x5668;&#xFF0C;&#x6BD5;&#x7ADF;&#x8001;&#x662F;&#x7528;appdelegat&#x662F;&#x6BD4;&#x8F83;&#x70E6;&#x7684;&#xFF0C;so pass the managed context from class to class via a property.</p>
<p>&#x5728;&#x63A7;&#x5236;&#x5668;&#x4E2D;&#xFF0C;&#x4ECE;plist&#x4E2D;&#x83B7;&#x53D6;&#x6570;&#x636E;&#xFF0C;and insert all the bow tie data you had in SampleData.plist into Core Data<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &#x4ECE;plist&#x83B7;&#x53D6;&#x6570;&#x636E;&#xFF0C;&#x7136;&#x540E;&#x63D2;&#x5165;&#x5230;data</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">insertSampleData</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure></p>
<p>&#x60F3;&#x770B;&#x770B;&#x8FD9;&#x4E24;&#x79CD;&#x7279;&#x6B8A;&#x7C7B;&#x578B;&#x662F;&#x600E;&#x4E48;&#x4FDD;&#x5B58;&#x7684;&#xFF0C;&#x5982;&#x4E0B;&#xFF1A;<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// image&#x8F6C;&#x53D8;&#x4E3A;NSData&#x4FDD;&#x5B58;</span></span><br><span class="line"><span class="keyword">let</span> photoData = <span class="type">UIImagePNGRepresentation</span>(image)</span><br><span class="line"><span class="comment">// &#x989C;&#x8272;&#x76F4;&#x63A5;&#x7528;UIColor&#x4FDD;&#x5B58; &#xFF0D; &#x4E00;&#x4E2A;&#x4E13;&#x95E8;&#x7531;RGB&#x8FD4;&#x56DE;&#x989C;&#x8272;&#x7684;&#x65B9;&#x6CD5;</span></span><br><span class="line">bowtie.tintColor = colorFromDict(tintColotDict)</span><br></pre></td></tr></table></figure></p>
<p>&#x8FD9;&#x91CC;&#x6D89;&#x53CA;&#x5230;&#x4E00;&#x4E2A;&#x7C7B;&#x4F3C;SQL&#x4E2D;WHERE&#x8BED;&#x53E5;&#x7684;&#x67E5;&#x627E;&#x7684;&#x7C7B;&#xFF0C;NSPredicate&#xFF0C;&#x7528;&#x6CD5;&#x7B80;&#x5355;&#x907F;&#x514D;&#x4E86;&#x4F60;&#x53BB;&#x5B66;&#x4E60;&#x706B;&#x661F;&#x7684;&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x6BD4;&#x5982;&#x8981;&#x5728;firstName&#x4E2D;&#x67E5;&#x627E;&#x2019;Bob&#x2019;&#xFF1A;<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">NSPredicate</span> predicateWithFormat:@<span class="string">&quot;firstName = &apos;Bob&apos;&quot;</span>];</span><br></pre></td></tr></table></figure></p>
<p>&#x5F53;&#x7136;&#x8FD9;&#x91CC;&#x4EC5;&#x4EC5;&#x53EA;&#x662F;&#x67E5;&#x8BE2;&#x6EE1;&#x8DB3;&#x201C; searchKey ! = nil&#x201D;&#xFF08;&#x62E5;&#x6709;searchKey&#xFF09;&#x7684;&#x6570;&#x91CF;&#xFF0C;&#x6CA1;&#x6709;&#x7528;&#x5230;&#x7B5B;&#x9009;&#x529F;&#x80FD;&#xFF1A;<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// &#x83B7;&#x53D6;data&#x4E2D;&#x5DF2;&#x5B58;&#x5728;&#x6570;&#x636E;&#x7684;&#x6570;&#x91CF;</span></span><br><span class="line"><span class="keyword">let</span> fetchRequset = <span class="type">NSFetchRequest</span>(entityName: <span class="string">&quot;Bowtie&quot;</span>)</span><br><span class="line">fetchRequset.predicate = <span class="type">NSPredicate</span>(format: <span class="string">&quot;searchKey ! = nil&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="built_in">count</span> = managedContest.countForFetchRequest(fetchRequset, error: <span class="literal">nil</span>)</span><br></pre></td></tr></table></figure></p>
<p>ok&#xFF0C;&#x4FDD;&#x5B58;&#x641E;&#x5B9A;&#x4E86;&#xFF0C;Now you need to access the data from somewhere&#xFF01;</p>
<p>&#x6240;&#x4EE5;&#x5F00;&#x59CB;&#x83B7;&#x53D6;&#x521D;&#x59CB;&#x6570;&#x636E;&#x5427;&#xFF01;&#x8FD9;&#x4E00;&#x6B65;&#x6211;&#x4EEC;&#x8981;&#x5B8C;&#x6210;<br>This is where you fetch the Bowties from Core Data and populate the UI. &#x5728;ViewDidLoad&#x4E2D;&#x6DFB;&#x52A0;&#x83B7;&#x53D6;&#x7684;&#x4EE3;&#x7801;&#xFF1A;<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2 &#x4ECE;coreData&#x83B7;&#x53D6;&#x6570;&#x636E;</span></span><br><span class="line"><span class="keyword">let</span> request = <span class="type">NSFetchRequest</span>(entityName: <span class="string">&quot;Bowtie&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> firstTitle = segmentedControl.titleForSegmentAtIndex(<span class="number">0</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;&#x8981;&#x67E5;&#x627E;seg&#x7684;title&#xFF3B;0&#xFF3D;&#xFF1A; <span class="subst">\(firstTitle)</span>&quot;</span>)</span><br><span class="line"><span class="comment">// 3 &#x6839;&#x636E;segment&#x7684;tilte&#x914D;&#x7F6E;&#x8BF7;&#x6C42;&#xFF0C;&#x7136;&#x540E;&#x6267;&#x884C;&#x67E5;&#x627E;&#x76F8;&#x5E94;&#x6570;&#x636E;</span></span><br><span class="line">request.predicate = <span class="type">NSPredicate</span>(format: <span class="string">&quot;searchKey == %@&quot;</span>,      firstTitle!)</span><br><span class="line"><span class="keyword">var</span> error: <span class="type">NSError</span>? = <span class="literal">nil</span></span><br><span class="line"><span class="keyword">var</span> results = managedContest.executeFetchRequest(request, error: &amp;error) <span class="keyword">as</span>! [<span class="type">Bowtie</span>]?</span><br><span class="line"><span class="comment">// 4 &#x6839;&#x636E;&#x83B7;&#x53D6;&#x7ED3;&#x679C;&#x7684;&#xFF3B;Bowtie&#xFF3D;&#x96C6;&#x5408;&#xFF0C;&#x5C55;&#x793A;UI   &amp;   &#x9519;&#x8BEF;&#x5904;&#x7406;</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> bowties = results {</span><br><span class="line">     populate(bowties[<span class="number">0</span>])</span><br><span class="line">}<span class="keyword">else</span> {</span><br><span class="line">     <span class="built_in">print</span>(<span class="string">&quot;&#x672A;&#x80FD;&#x83B7;&#x53D6;<span class="subst">\(error)</span>,<span class="subst">\(error!.userInfo)</span>&quot;</span>)</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>populate&#x65B9;&#x6CD5;&#x5C31;&#x662F;&#x5C06;&#x6309;&#x7167;searchKey&#x83B7;&#x53D6;&#x5230;&#x7684;&#x6570;&#x636E;&#x653E;&#x5165;&#xFF3B;Bowtie&#xFF3D;&#x96C6;&#x5408;&#x540E;&#xFF0C;&#x8D1F;&#x8D23;&#x5C55;&#x793A;&#x5230;UI&#x4E0A;&#xFF0C;&#x5C31;&#x662F;&#x628A;&#x8BE5;&#x663E;&#x793A;&#x7684;UI&#x7684;&#x6570;&#x636E;&#x88C5;&#x8FDB;&#x53BB;&#xFF0C;&#x5927;&#x90E8;&#x5206;&#x6CA1;&#x6709;&#x6280;&#x672F;&#x542B;&#x91CF;&#xFF0C;&#x53EA;&#x6311;&#x9009;&#x4EE5;&#x4E0B;&#x51E0;&#x70B9;&#xFF0C;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#x6570;&#x636E;&#x7684;&#x683C;&#x5F0F;&#x9700;&#x8981;&#x8F6C;&#x5316;&#xFF0C;&#x5982;NSNumber&#x5230;Bool&#xFF1A;<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &#x56FE;&#x7247; &#xFF0D; &#x7531;&#x4E8C;&#x8FDB;&#x5236;&#x63D0;&#x4F9B;</span></span><br><span class="line">imageView.image = <span class="type">UIImage</span>(data: bowtie.photoData)</span><br><span class="line"><span class="comment">// &#x989C;&#x8272;&#x4F9D;&#x65E7;&#x662F;&#x989C;&#x8272;</span></span><br><span class="line">view.tintColor = bowtie.tintColor <span class="keyword">as</span>! <span class="type">UIColor</span></span><br><span class="line"><span class="comment">// NSNumber -&gt; bool</span></span><br><span class="line">favoriteLabel.hidden = !bowtie.isFavorite.boolValue</span><br></pre></td></tr></table></figure></p>
<p>&#x7136;&#x540E;&#x8FD0;&#x884C;&#xFF0C;&#x770B;&#x5230;&#x8FD9;&#x6837;&#xFF1A;<br><img src="/img/CoreData1_008.png" alt=""><br>&#x73B0;&#x5728;&#x5145;&#x5206;&#x8BC1;&#x660E;&#x6211;&#x4EEC;&#x5BF9;CoreData&#x6570;&#x636E;&#x7684;&#x5B58;&#xFF0C;&#x53D6;&#xFF0C;&#x67E5;&#x90FD;&#x662F;&#x6210;&#x529F;&#x7684;&#xFF0C;&#x4E0B;&#x9762;&#x6765;&#x5B8C;&#x5584;&#x5176;&#x4ED6;&#x529F;&#x80FD;&#xFF0C;&#x4E3A;&#x4E86;&#x80FD;&#x7ED9;&#x5F53;&#x524D;&#x663E;&#x793A;&#x7684;&#x9886;&#x7ED3;&#x8FDB;&#x884C;&#x8BC4;&#x5206;&#x7B49;&#x64CD;&#x4F5C;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x5C5E;&#x6027;&#x7528;&#x4EE5;&#x7EAA;&#x5F55;&#x5F53;&#x524D;&#x9886;&#x7ED3;&#xFF0C;so&#xFF1A;<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &#x5F53;&#x524D;&#x663E;&#x793A;&#x9886;&#x7ED3;</span></span><br><span class="line"><span class="keyword">var</span> currentBowtie: <span class="type">Bowtie</span>!</span><br></pre></td></tr></table></figure></p>
<p>&#x7136;&#x540E;&#x5C31;&#x662F;&#x5B9E;&#x73B0;&#x548C;&#x6DFB;&#x52A0;wear&#x548C;rate&#x529F;&#x80FD;&#x4E86;&#xFF0C;&#x5B8C;&#x6210;&#x4E4B;&#x540E;&#x53D1;&#x73B0;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x5C31;&#x662F;rate&#x6211;&#x4EEC;&#x60F3;&#x89C4;&#x5B9A;&#x4E2D;0-5&#xFF0C;&#x4F46;&#x662F;&#x76F4;&#x63A5;&#x8DD1;&#x5230;&#x4E86;6&#xFF0C;&#x901A;&#x5E38;&#x90FD;&#x662F;&#x8003;&#x8651;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x8F93;&#x5165;&#x65F6;&#x53BB;&#x63D0;&#x793A;&#x9650;&#x5B9A;&#xFF0C;&#x4F46;&#x6709;&#x4E2A;&#x66F4;&#x7B80;&#x5355;&#x7684;&#x529E;&#x6CD5;&#xFF0C;&#x5C31;&#x662F;&#x5229;&#x7528;Xcode&#x5BF9;rate&#x505A;&#x4E9B;&#x9650;&#x5B9A;&#x5904;&#x7406;&#xFF1A;<br><img src="/img/CoreData1_009.png" alt=""></p>
<p>&#x9700;&#x8981;&#x989D;&#x5916;&#x8BF4;&#x660E;&#x7684;&#x662F;&#xFF0C;&#x7EDD;&#x5BF9;&#x4E0D;&#x8981;&#x8F7B;&#x6613;version &#x6A21;&#x578B;&#x8BBE;&#x7F6E;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x5728;&#x4F60;&#x5DF2;&#x7ECF;&#x53D1;&#x5E03;&#x7248;&#x672C;&#x4E4B;&#x540E;&#xFF0C;&#x56E0;&#x4E3A;&#x66F4;&#x65B0;&#x65F6;&#x5F88;&#x53EF;&#x80FD;&#x4F1A;&#x5E26;&#x6765;&#x4E25;&#x91CD;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x4F46;Attribute validation is one of the few exceptions.&#x66F4;&#x591A;&#x76F8;&#x5173;&#x8BA8;&#x8BBA;&#x5148;&#x5F80;&#x540E;&#x653E;&#x3002;<br>&#x5F53;&#x518D;&#x6B21;&#x8F93;&#x5165;&#x4E0D;&#x518D;&#x8303;&#x56F4;&#x7684;&#x6570;&#x636E;&#x65F6;&#xFF0C;&#x5C31;&#x4F1A;&#x6709;&#x9519;&#x8BEF;&#x63D0;&#x5347;&#xFF1A;</p>
<blockquote>
<p>Optional(&#x201C;R&#x201D;)currentBowtie&#x66F4;&#x65B0;rate&#x540E;&#xFF0C;&#x672A;&#x80FD;&#x4FDD;&#x5B58;Optional(Error Domain=NSCocoaErrorDomain Code=1610<br>&#x201C;The operation couldn&#x2019;t be completed. (Cocoa error 1610.)&#x201D;</p>
</blockquote>
<p>&#x6839;&#x636E;&#x9519;&#x8BEF;&#x5BF9;&#x5E94;&#x7684;&#x5904;&#x7406;&#x4E5F;&#x662F;&#x5FC5;&#x987B;&#x7684;&#xFF1A;<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> error: <span class="type">NSError</span>?</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> !managedContest.save(&amp;error) {</span><br><span class="line"><span class="comment">/*</span><br><span class="line">&#x5982;&#x679C;&#x8F93;&#x5165;&#x7684;&#x8BC4;&#x5206;&#x8FC7;&#x5927;&#x6216;&#x8FC7;&#x5C0F;&#xFF0C;&#x8BC4;&#x5206;&#x65E0;&#x6548;</span><br><span class="line"></span><br><span class="line">*/</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;currentBowtie&#x66F4;&#x65B0;rate&#x540E;&#xFF0C;&#x672A;&#x80FD;&#x4FDD;&#x5B58;<span class="subst">\(error)</span>,<span class="subst">\(error!.userInfo)</span>&quot;</span>)</span><br><span class="line">     <span class="keyword">if</span> error!.code == <span class="type">NSValidationDateTooLateError</span> || error!.code ==      <span class="type">NSValidationDateTooSoonError</span> {</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">          rate(currentBowtie)</span><br><span class="line"></span><br><span class="line">     }</span><br><span class="line">}<span class="keyword">else</span> {</span><br><span class="line">     populate(currentBowtie)</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x8FD9;&#x6837;&#x5982;&#x679C;&#x8F93;&#x5165;&#x7684;&#x8BC4;&#x5206;&#x4E0D;&#x7B26;&#x5408;&#x9884;&#x671F;&#xFF0C;&#x8FC7;&#x5927;&#x6216;&#x8005;&#x8FC7;&#x5C0F;&#x8BC4;&#x5206;&#x65E0;&#x6548;&#x5C31;&#x662F;&#x4E86;</p>
<p>&#x8FD8;&#x5269;&#x4E0B;&#x4E00;&#x70B9;&#x513F;&#x6839;&#x636E;&#x4E0D;&#x540C;segumentTitle&#x5339;&#x914D;&#x4E0D;&#x540C;&#x6570;&#x636E;&#x7684;&#x529F;&#x80FD;&#x5C31;&#x4E0D;&#x518D;&#x8D58;&#x8FF0;&#x4E86;&#xFF0C;&#x7559;&#x4E00;&#x70B9;&#x513F;&#x7EC3;&#x624B;&#x7684;&#x673A;&#x4F1A;&#x81EA;&#x5DF1;&#x6162;&#x6162;&#x73A9;&#x513F;&#x5427;&#x2026;</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    

    </div>

    
  </div>
</article>


    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2017 13hoop
    
  </p>
</footer>
    
  </div>
</div>
</body>
</html>