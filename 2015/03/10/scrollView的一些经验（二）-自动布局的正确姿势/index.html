<html>
<head>
	
	<title>scrollView的一些经验（二）--自动布局的正确姿势</title>
	<meta name="keywords" content="My Blog, Spider Bitch!" />

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    
    <!--<link rel="stylesheet" href="/css/main.css">-->
	<link href="/css/main.css?v=2" rel="stylesheet" type="text/css" />
    <!--<link rel="stylesheet" href="/css/style.css">-->
    

    <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Atom feed">

    
	<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2"/>
    

</head>

<body>

<h3 id="利用storyBoard尝试自动布局ScrollView"><a href="#利用storyBoard尝试自动布局ScrollView" class="headerlink" title="利用storyBoard尝试自动布局ScrollView"></a>利用<code>storyBoard</code>尝试自动布局ScrollView</h3><p>实际测试如下：</p>
<h4 id="1-scrollView-imageView（Sizefit）"><a href="#1-scrollView-imageView（Sizefit）" class="headerlink" title="1 scrollView + imageView（Sizefit）"></a>1 scrollView + imageView（Sizefit）</h4><p><img src="/img/ScrollView2_001.png" alt=""><br><img src="/img/ScrollView2_002.png" alt=""></p>
<p><strong>失败！</strong></p>
<h4 id="2-imageView修改：只有leading和TopSpace-然后再代码中添加打印："><a href="#2-imageView修改：只有leading和TopSpace-然后再代码中添加打印：" class="headerlink" title="2 imageView修改：只有leading和TopSpace,然后再代码中添加打印："></a>2 imageView修改：只有leading和TopSpace,然后再代码中添加打印：</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="keyword">self</span>.view layoutIfNeeded]; <span class="comment">// 此行之前的layout被计算</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"设置了imageView后 %@"</span>, <span class="keyword">self</span>.scrollView);</span><br></pre></td></tr></table></figure>
<p><img src="/img/ScrollView2_003.png" alt=""></p>
<p><strong>失败！again</strong></p>
<p>原因分析：通过打印可看出，上述两种方法都无法给出contentSize</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2015-03-11 11:27:32.577 ScrollTagDemo[2393:259138] 只是设置了scrollView的约束，&lt;UIScrollView: 0x7aaf1a00; frame = (190 190; 220 220); clipsToBounds = YES; autoresize = RM+BM; gestureRecognizers = &lt;NSArray: 0x788a1750&gt;; layer = &lt;CALayer: 0x78689bb0&gt;; contentOffset: &#123;0, 0&#125;; contentSize: &#123;0, 0&#125;&gt;</span><br><span class="line">2015-03-11 11:27:32.579 ScrollTagDemo[2393:259138] 设置了imageView后 &lt;UIScrollView: 0x7aaf1a00; frame = (50 130; 220 220); clipsToBounds = YES; autoresize = RM+BM; gestureRecognizers = &lt;NSArray: 0x788a1750&gt;; layer = &lt;CALayer: 0x78689bb0&gt;; contentOffset: &#123;0, 0&#125;; contentSize: &#123;0, 0&#125;&gt;</span><br></pre></td></tr></table></figure>
<h4 id="3-imageView再修改，先使用代码："><a href="#3-imageView再修改，先使用代码：" class="headerlink" title="3 imageView再修改，先使用代码："></a>3 imageView再修改，先使用代码：</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">self</span>.scrollView.contentSize = <span class="keyword">self</span>.imageView.bounds.size;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"设置了contentSize的frame之后，%@"</span>, <span class="keyword">self</span>.scrollView);</span><br></pre></td></tr></table></figure>
<p><strong>success！</strong></p>
<p>此时的打印contentSize：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2015-03-11 11:52:11.289 ScrollTagDemo[2460:266559] 设置了contentSize的frame之后，&lt;UIScrollView: 0x7b885c00; frame = (190 190; 220 220); clipsToBounds = YES; autoresize = RM+BM; gestureRecognizers = &lt;NSArray: 0x7b06a2e0&gt;; layer = &lt;CALayer: 0x7b064680&gt;; contentOffset: &#123;0, 0&#125;; contentSize: &#123;759, 966&#125;&gt;</span><br></pre></td></tr></table></figure></p>
<p>所以原因的确是contentSize的问题，这种方式就是官方给出的所谓混合解决方式，但在layout中设置frame可是不常见的，在我看来这有悖于layout的实质，可用但值得商榷，那么就继续探索能够使用约束给出contentSize的方法。<br>再次修改imageView：</p>
<p><img src="/img/ScrollView2_004.png" alt=""></p>
<p><strong>失败，again！</strong></p>
<p>按理说，给定img的宽高，就应该有contentSize了，但遗憾的是木有😢<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2015-03-11 12:01:10.255 ScrollTagDemo[2525:271602] 设置了contentSize的frame之后，&lt;UIScrollView: 0x7ca72600; frame = (190 190; 220 220); clipsToBounds = YES; autoresize = RM+BM; gestureRecognizers = &lt;NSArray: 0x7c1926d0&gt;; layer = &lt;CALayer: 0x7c18cd80&gt;; contentOffset: &#123;0, 0&#125;; contentSize: &#123;0, 0&#125;&gt;</span><br></pre></td></tr></table></figure></p>
<h4 id="4-imageView再修改，这次在第二次的基础上尝试："><a href="#4-imageView再修改，这次在第二次的基础上尝试：" class="headerlink" title="4 imageView再修改，这次在第二次的基础上尝试："></a>4 imageView再修改，这次在第二次的基础上尝试：</h4><p><img src="/img/ScrollView2_005.png" alt=""></p>
<p><strong>success！it works！</strong></p>
<p>但是对比先前的<br><img src="/img/ScrollView2_006.png" alt=""></p>
<p>仅仅是把Trainling跟Bottom变成了0，0而已，<strong>it works！</strong></p>
<p>由此可见：subView的约束是根据contentSize计算而来的，而不是scroll自己！<br>但是但是，打印的结果仍然是：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2015-03-11 12:10:35.446 ScrollTagDemo[2556:281194] 设置了contentSize的frame之后，&lt;UIScrollView: 0x7b075600; frame = (190 190; 220 220); clipsToBounds = YES; autoresize = RM+BM; gestureRecognizers = &lt;NSArray: 0x7aa2a2f0&gt;; layer = &lt;CALayer: 0x7a8795f0&gt;; contentOffset: &#123;0, 0&#125;; contentSize: &#123;0, 0&#125;&gt;</span><br></pre></td></tr></table></figure></p>
<p>肯定是打印的地方不对，到底在哪儿呢？再试试，通过自定义view，猜测是laySubViews，重写之后结果验证如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">2015-03-11 13:49:47.407 ScrollTagDemo[2846:353070] 设置了imageView后 &lt;UIScrollView: 0x7bbaf000; frame = (190 190; 220 220); clipsToBounds = YES; autoresize = RM+BM; gestureRecognizers = &lt;NSArray: 0x7c145be0&gt;; layer = &lt;CALayer: 0x7b62da80&gt;; contentOffset: &#123;0, 0&#125;; contentSize: &#123;0, 0&#125;&gt;</span><br><span class="line">2015-03-11 13:49:47.407 ScrollTagDemo[2846:353070] 设置了contentSize的frame之后，&lt;UIScrollView: 0x7bbaf000; frame = (190 190; 220 220); clipsToBounds = YES; autoresize = RM+BM; gestureRecognizers = &lt;NSArray: 0x7c145be0&gt;; layer = &lt;CALayer: 0x7b62da80&gt;; contentOffset: &#123;0, 0&#125;; contentSize: &#123;0, 0&#125;&gt;</span><br><span class="line">2015-03-11 13:49:47.412 ScrollTagDemo[2846:353070] --------------&gt;</span><br><span class="line">2015-03-11 13:49:47.413 ScrollTagDemo[2846:353070] timeOfLayout 1</span><br><span class="line">2015-03-11 13:49:47.413 ScrollTagDemo[2846:353070] scrollView.contentSize:&#123;0, 0&#125;</span><br><span class="line">&lt;!-- 2015-03-11 13:49:47.413 ScrollTagDemo[2846:353070] --------------&gt; --&gt;</span><br><span class="line">2015-03-11 13:49:47.413 ScrollTagDemo[2846:353070] timeOfLayout 2</span><br><span class="line">2015-03-11 13:49:47.413 ScrollTagDemo[2846:353070] scrollView.contentSize:&#123;759, 966&#125;</span><br></pre></td></tr></table></figure></p>
<p>在整个viewDidLoad中都没有计算contentSize，而是在结束之后由系统去view的 layoutSubviews方法中计算的&lt;在iOS8之前是要自己去加上一句的&gt;！</p>
<h4 id="5-再测试："><a href="#5-再测试：" class="headerlink" title="5 再测试："></a>5 再测试：</h4><p>imageView再添加约束，让其的w和h 跟 scrollView的w和h 相等</p>
<p><img src="/img/ScrollView2_007.png" alt=""></p>
<p><strong>also worked!</strong><br>打印输出：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">2015-03-11 15:52:42.841 ScrollTagDemo[3154:467930] --------------&gt;</span><br><span class="line">2015-03-11 15:52:42.841 ScrollTagDemo[3154:467930] timeOfLayout 1</span><br><span class="line">2015-03-11 15:52:42.884 ScrollTagDemo[3154:467930] scrollView.frame:&#123;&#123;250, 190&#125;, &#123;100, 220&#125;&#125;</span><br><span class="line">2015-03-11 15:52:42.884 ScrollTagDemo[3154:467930] scrollView.contentSize:&#123;0, 0&#125;</span><br><span class="line">2015-03-11 15:52:42.885 ScrollTagDemo[3154:467930] --------------&gt;</span><br><span class="line">2015-03-11 15:52:42.885 ScrollTagDemo[3154:467930] timeOfLayout 2</span><br><span class="line">2015-03-11 15:52:42.885 ScrollTagDemo[3154:467930] scrollView.frame:&#123;&#123;250, 190&#125;, &#123;100, 220&#125;&#125;</span><br><span class="line">2015-03-11 15:52:42.885 ScrollTagDemo[3154:467930] scrollView.contentSize:&#123;759, 966&#125;</span><br></pre></td></tr></table></figure></p>
<p>发现根本 scrollView.frame就没有变化，但是这明显与通常理解的矛盾，明明已经相等而数值不同，其实这就是系统针对scrollView做的特殊处理，其实并没有真正去加上这个约束，加的其实是：</p>
<h4 id="finally"><a href="#finally" class="headerlink" title="finally"></a>finally</h4><p><img src="/img/ScrollView2_008.png" alt=""></p>
<p>这就是scrollView的完整约束！这也就是在官方文档中所提到的<strong>“by creating constraints between the view and a view outside the scroll view’s subtree, such as the scroll view’s superview”</strong></p>
<p><img src="/img/ScrollView2_009.png" alt=""></p>
<p>将这个所谓相等的约束引用更改，就能结合代码更改contentSize</p>
<p>脑洞：既然结果显示w和h可以设置为“&gt;=”，是否意味着可以自己来设置这样的约束对方，没实验，不过估计即便可以也不会有人去这样设置的👌！……^_^</p>


<!--<a href="http://13hoop.github.io/2015/03/10/scrollView的一些经验（二）-自动布局的正确姿势/#disqus_thread" class="article-comment-link">Comments</a>-->
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = '13hoopgithub'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

<div style="display:none">
<script src="http://s4.cnzz.com/stat.php?id=undefined&web_id=undefined" language="JavaScript"></script>script>
</div>







</body>
</html>