<html>
<head>
	
	<title>CoreData(äºŒ)</title>
	<meta name="keywords" content="My Blog, Spider Bitch!" />

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    
    <!--<link rel="stylesheet" href="/css/main.css">-->
	<link href="/css/main.css?v=2" rel="stylesheet" type="text/css" />
    <!--<link rel="stylesheet" href="/css/style.css">-->
    

    <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Atom feed">

    
	<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2"/>
    

</head>

<body>

<p>ä¸Šä¸€ç¯‡ä¸­ï¼Œå·²ç»ä½“éªŒäº†CoreDataçš„åŸºæœ¬ä½¿ç”¨ï¼Œå¯ä»¥é€šè¿‡Xcodeè®¾è®¡æ•°æ®æ¨¡å‹ï¼Œå¯ä»¥å¯¹æ•°æ®æŸ¥è¯¢ï¼Œå¢åŠ ï¼Œæ›´æ”¹ï¼Œä½†è¿˜ä¸çŸ¥é“å®ƒçš„çœŸæ­£å·¥ä½œæœºåˆ¶ï¼Œè€Œè¿™å°†æ˜¯è¿™ä¸€ç¯‡çš„ä¸»è¦å†…å®¹</p>
<p>Core Data Stackï¼Œthe stack is made up of four Core Data Classes:</p>
<ul>
<li>NSManagedObjectModel - æ‰˜ç®¡å¯¹è±¡æ¨¡å‹</li>
<li>NSPersistentStore ï¼ æŒä¹…åŒ–å­˜å‚¨</li>
<li>NSPersistentStoreCoordinator ï¼ æŒä¹…åŒ–å­˜å‚¨åè°ƒå™¨</li>
<li>NSManagedObjectContext ï¼ æ‰˜ç®¡å¯¹è±¡ä¸Šä¸‹æ–‡<br>æˆ‘ä»¬å·²ç»å’Œä¸Šä¸‹æ–‡NSManagedObjectContextæ‰“è¿‡äº¤é“äº†ï¼Œå¯æƒ³è€ŒçŸ¥å…¶ä»–3ä¸ªæ˜¯ç›¸å¯¹åº•å±‚çš„ä¾èµ–åœ¨æ”¯æ´è€…ä¸Šä¸‹æ–‡ï¼Œæ‰€ä»¥è¿˜æ˜¯è€è§„çŸ©å€ŸåŠ©ä¸€ä¸ªDemoå¼€å§‹å§ã€‚</li>
</ul>
<p><strong>what we do later</strong></p>
<p>Rather than rely on the default starter template, youâ€™ll build your own Core Data stack: a customizable â€œwrapperâ€ around these classes that works as a unit.</p>
<p>ä¸€ä¸ªåå«â€dog-walkâ€çš„å°Demoï¼Œå®ƒå¯ä»¥ä¿å­˜ä½ é›ç‹—çš„æ—¶é—´æ—¥æœŸå¹¶å±•ç¤ºåˆ°tableViewã€‚ä¸åŒçš„æ˜¯ï¼Œæˆ‘ä»¬ä¸å†ä¾èµ–Xcodeçš„è‡ªåŠ¨æ¨¡ç‰ˆã€‚</p>
<hr>
<p>ä¸è¿‡å†æ¬¡ä¹‹å‰ï¼Œå…ˆè¦éš†é‡å¯„å‡ºè¿™4ä¸ª<strong>å…³é”®ç±»</strong></p>
<ul>
<li><strong>the mamaged object model</strong></li>
</ul>
<p>NSManagedObjectModel represents each object type in your appâ€™s data model, the properties they can have, and the relationship between them. Other parts of the Core Data stack use the model to create objects, store properties and save data.<br>NSManagedObjectModelè¡¨å¾åº”ç”¨çš„æ•°æ®æ¨¡å‹ä¸­æ¯ä¸ªå¯¹è±¡çš„ç±»å‹ï¼Œä»¥åŠå¯¹è±¡åŒ…å«çš„å±æ€§å’Œå„å¯¹è±¡çš„å…³è”å…³ç³»ï¼ŒCoreDataçš„å…¶ä»–éƒ¨åˆ†ä½¿ç”¨modelåˆ›å»ºå¯¹è±¡ï¼Œä¿å­˜å±æ€§å’Œæ•°æ®ã€‚</p>
<ul>
<li><strong>the persistent store</strong><br>NSPersistentStore reads and writes data to whichever storage method youâ€™ve decided to use. Core Data provides four types of NSPersistentStore out of the box: three atomic and one non-atomic.</li>
</ul>
<p>NSPersistentStoreè¯»å†™æ•°æ®çš„æ–¹å¼ï¼ŒcoreDataæä¾›äº†å››ç§æ–¹å¼ï¼š</p>
<p>  <code>NSQLiteStoreType</code>(default + nonatomic,backed by SQLite)<br>  <code>NSXMLStoreType</code>(readable + atomic, blacked by XML File, but have a large memory footprint, so available on OS X)<br>  <code>NSBinaryStoreType</code>(just like XML, large memory cost + atomic,blacked by a binary data file)<br>  <code>NSInMemoryStoreType</code>(in-memory not really persistent, terminate disappears)</p>
<ul>
<li><strong>the persistent store coordinator</strong><br>NSPersistentStoreCoordinator is the bridge between the managed object model and the persistent store. It is responsible for using the model and the persistent stores to do most of the hard work in Core Data. It understands the NSManagedObjectModel and knows how to send information to, and fetch information from, the NSPersistentStore.<br>NSPersistentStoreCoordinator also hides the implementation details of how your persistent store or stores are configured. This is useful for two reasons:<ol>
<li>NSManagedObjectContext (coming next!) doesnâ€™t have to know if itâ€™s saving to an SQLite database, XML file or even iCloud.</li>
<li>If you have multiple persistent stores, the persistent store coordinator presents a unified interface to the managed context. As far as the managed context is concerned, it always interacts with a single, aggregate persistent store.</li>
</ol>
</li>
</ul>
<p><code>NSPersistentStoreCoordinator</code>è´Ÿè´£æ¡¥æ¥æ‰˜ç®¡å¯¹è±¡æ¨¡å‹å’ŒæŒä¹…åŒ–å‚¨å­˜ï¼Œè´Ÿè´£modelçš„ä½¿ç”¨å’Œå›ºåŒ–å­˜å‚¨ç­‰è‰°éš¾çš„å·¥ä½œï¼Œæ¨æ–­å‡ºâ€œå‘NSPersistentStoreå‘é€ä¿¡æ¯â€æˆ–è€…â€œä»NSPersistentStoreè·å–ä¿¡æ¯â€ç­‰è¡Œä¸ºã€‚NSPersistentStoreCoordinatorè¿˜éšè—äº†æ€æ ·æŒä¹…åŒ–å­˜å‚¨çš„é…ç½®çš„å…·ä½“å®æ–½ç»†åˆ™ã€‚è¿™æ ·ä¸€æ¥ï¼š</p>
<pre><code>1. ä¸Šä¸‹æ–‡ä¸éœ€è¦å…³å¿ƒæ•°æ®å›ºåŒ–çš„ç±»å‹ï¼Œä¸è®ºæ˜¯SQLiteï¼ŒXMLæˆ–è€…å…¶ä»–ç±»å‹ï¼›
2. å¦‚æœæ˜¯å¤šç§ç±»å‹æ··åˆä½¿ç”¨ï¼Œåè°ƒå™¨å°±ä¸ºä¸Šä¸‹æ–‡æä¾›ä¸€ä¸ªä¾¿äºç®¡ç†çš„ç»Ÿä¸€æ¥å£ã€‚
</code></pre><ul>
<li><strong>the managed object context</strong></li>
</ul>
<p><code>NSManagedObjectContext</code> is an in-memory â€˜scratchpadâ€™, do all works within it, and any changes wonâ€™t affect the underlying data on disk until you call save() on the context.<br>ä¸Šä¸‹æ–‡æ˜¯ä¸€ä¸ªå†…å­˜ä¸­çš„æš‚å­˜å™¨ï¼Œæ‰€æœ‰çš„å·¥ä½œéƒ½è¦ç”¨åˆ°å®ƒï¼Œä»»ä½•å˜åŠ¨åœ¨save()åˆ°ä¸Šä¸‹æ–‡ä¹‹å‰æ˜¯ä¸ä¼šå½±å“åˆ°ç¡¬ç›˜ä¸Šçš„æ•°æ®çš„ã€‚å®ƒæ˜¯å¦‚æ­¤çš„é‡è¦è¯·åŠ¡å¿…æ³¨æ„æ‰€ä»¥ä¸‹ç‰¹æ€§ï¼š</p>
<pre><code>1. The context manages the lifecycle of the objects that it creates or fetches. This lifecycle management includes powerful features such as faulting, inverse relationship handling and validation.
ä¸Šä¸‹æ–‡ç®¡ç†ç€å¯¹è±¡åˆ›å»ºå’Œè·å–çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸ ï¼åŒ…å«ä¸€äº›å¼ºå¤§çš„ç‰¹æ€§å¦‚é”™è¯¯ï¼Œé€†å‘å…³ç³»ä»¥åŠéªŒè¯ã€‚
2. A managed object cannot exist without an associated context. In fact, a managed object and its context are so tightly coupled that every managed object keeps a reference to its context, which can be accessed like so:
</code></pre><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> employeeContext = employee.managedObjectContext</span><br></pre></td></tr></table></figure>
<pre><code>æ‰˜ç®¡å¯¹è±¡ä¸èƒ½ç‹¬ç«‹äºå…¶ä¸Šä¸‹æ–‡è€Œå•ç‹¬å­˜åœ¨ï¼Œä»–ä»¬æ˜¯å¦‚æ­¤ç´§å¯†çš„è€¦åˆï¼Œä»¥è‡´äºæˆ‘ä»¬çº¦å®šä»¥è¿™æ ·çš„å‘½åå’Œä»£ç æ¥è·å–å®ƒã€‚
3. Contexts are very territorial; once a managed object has associated with a particular context, it will remain associated with the same context for the duration of its lifecycle.
ä¸Šä¸‹æ–‡æ˜¯éå¸¸è‡ªå«çš„ï¼ˆé¢†åœŸçš„ï¼ŒçœŸä¸å¥½ç¿»è¯‘ğŸ˜“ï¼‰ï¼Œä¸€æ—¦æ‰˜ç®¡å¯¹è±¡æŒ‡å®šäº†ä¸€ä¸ªä¸Šä¸‹æ–‡ï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªå¯¹è±¡çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸéƒ½å°†å’Œå…ˆå‰æŒ‡å®šçš„ä¸Šä¸‹æ–‡æ†ç»‘å…³è”ã€‚
4. An application can use more than one contextâ€”most non-trivial Core Data applications fall into this category. Since a context is an in-memory scratch pad for whatâ€™s on disk, you can actually load the same Core Data object onto two different contexts simultaneously.
ä¸€ä¸ªåº”ç”¨ç¨‹åºå¯ä»¥æ‹¥æœ‰ä¸æ­¢ä¸€ä¸ªä¸Šä¸‹æ–‡ï¼Œè®¸å¤šä¼˜ç§€çš„åº”ç”¨éƒ½ä½¿ç”¨è¿™ä¸€ç‰¹æ€§ã€‚å› ä¸ºå®ƒä»…ä»…åªæ˜¯ç£ç›˜ä¸Šå†…å®¹åœ¨å†…å­˜ä¸­çš„ä¸€ä¸ªæš‚å­˜ï¼Œæ‰€ä»¥ä½ å¤§å¯ä»¥åŒæ—¶é€šè¿‡ä¸åŒçš„ä¸Šä¸‹æ–‡åŠ è½½åŒä¸€ä»½CoreDataå¯¹è±¡ã€‚
5. A context is not thread safe. The same goes for a managed objectâ€”you can only interact with contexts and managed objects on the same thread in which they were created. Apple has provided many ways to work with contexts in multithreaded applications. Youâ€™ll read all about different concurrency models in Chapter 10, â€œMultiple Managed Object Contexts.â€
ä¸Šä¸‹æ–‡ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ŒåŒæ ·æ‰˜ç®¡å¯¹è±¡ä¹Ÿä¸æ˜¯ï¼Œæ‰€ä»¥ä½ æ­£èƒ½åœ¨åˆ›å»ºå®ƒä»¬çš„åŒä¸€çº¿ç¨‹ä¸­ä¸ä»–ä»¬äº¤äº’ã€‚Appleä¹Ÿæä¾›äº†å¾ˆå¤šç§ä¸Šä¸‹æ–‡åœ¨ä¸åŒçº¿ç¨‹å·¥ä½œçš„æœºåˆ¶ï¼Œåé¢ä¼šä»‹ç»åˆ°ã€‚
</code></pre><p><strong>æ€»ä¹‹NSManagedObjectContextæ˜¯ä¸€ä¸ªå¼ºå¤§ï¼Œç‰›æ°”ï¼Œä¸“ä¸šï¼Œå¿ è¯šè€Œåˆè„†å¼±çš„ä¸€ç‰‡å†…å­˜æš‚å­˜ã€‚</strong></p>


<!--<a href="http://13hoop.github.io/2015/03/13/CoreData-äºŒ/#disqus_thread" class="article-comment-link">Comments</a>-->
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = '13hoopgithub'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

<div style="display:none">
<script src="http://s4.cnzz.com/stat.php?id=undefined&web_id=undefined" language="JavaScript"></script>script>
</div>







</body>
</html>